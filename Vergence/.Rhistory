f<-rbindlist(apply(ftimes,1,jsac))
f<- select(f,-event.dur)
f$issaccade=FALSE
g$issaccade=TRUE
fg<-rbind(f,g)
fg<- arrange(fg,time)
fg$event[!fg$issaccade]=fg$event[!fg$issaccade]*-1
if (length(fg$event)!=datalength){
message('FAIL')
message(length(fg$event))
message(datalength)
# message(paste('FAILED: ',length(fg$event,datalength,sep='-')))
}
else{
# message('SUCCESS')
}
fg$event
}
h %>%
select(G,H,T) %>% #these are the only data we need
mutate(G=replace(G,G==0,NA), #mark missing data as NA rather than 0
Gv=parabolicdiff(G,7)*samplerate,
Hv=parabolicdiff(H,7)*samplerate,
target.velocity=parabolicdiff(T,7)*samplerate,
time=row_number(),
# gazeshifts=markSaccades(Gv,buffer=5,threshold=30),
gazeshifts=markSaccadesDouble(Gv,threshold1=60,threshold2=15),
headmovement=markSaccadesDouble(Hv,threshold1=15,threshold2=6),
headmovement=replace(headmovement,headmovement<0,0),
gazeshifts=replace(gazeshifts,gazeshifts<0,0)) %>%
markTagetMovements(buffer=200,threshold=1000,saccade.length=500) %>%
group_by(sacnum) %>%
mutate(firstshift=min(gazeshifts[counter>200&gazeshifts>0],na.rm=T),
gazeshifts=replace(gazeshifts,
gazeshifts!=firstshift|is.na(firstshift),
0),
gazeshifts=replace(gazeshifts,gazeshifts==0,NA),
headmovement=replace(headmovement,headmovement==0,NA),
counter=counter-200)->
hh
hh %>%
group_by(sacnum) %>%
mutate(gvsd=round(sd(Gv[1:300])))->
hh
hh %>%
# filter(sacnum==10)%>%
group_by(sacnum) %>%
mutate(gaze.dur=length(counter[!is.na(gazeshifts)])) %>%
ungroup() %>%
filter(gaze.dur>5) ->
hint
hint%>%
group_by(sacnum)%>%
summarize(gaze.onset=counter[!is.na(gazeshifts)][1],
gaze.offset=max(counter[!is.na(gazeshifts)]),
gaze.dur=gaze.offset-gaze.onset,
gaze.amp=G[counter==gaze.offset]-G[counter==gaze.onset],
IHP=H[counter==gaze.onset],
IGP=G[counter==gaze.onset],
IEP=IGP-IHP,
peak.gaze.velocity=maxabs(Gv[!is.na(gazeshifts)]),
peak.head.velocity=maxabs(Hv[100:n()])) %>%
filter(gaze.onset>0,gaze.onset<200)->
hp
manipulate(ggplot(filter(hh,sacnum==chosensac))+
geom_line(aes(counter,H),color='blue')+
# geom_line(aes(counter,Ef),color='red')+
geom_line(aes(counter,G),color='darkgreen')+
geom_line(aes(counter,T),size=2,alpha=0.5)+
geom_line(aes(counter,Hv/10),color='blue',linetype=2)+
# geom_line(aes(counter,EV/10),color='red')+
geom_line(aes(counter,Gv/10),color='darkgreen',linetype=2)+
# geom_text(x=0,y=50,aes(label=round(sd(Gv),2)))+
# geom_text(x=0,y=60,aes(label=firstshift[1]))+
geom_point(aes(counter,sign(gazeshifts)*50))+
geom_point(aes(counter,sign(headmovement)*25),color='blue')
,
chosensac=slider(1,length(unique(hh$sacnum))))
h %>%
select(G,H,T) %>% #these are the only data we need
mutate(G=replace(G,G==0,NA), #mark missing data as NA rather than 0
Gv=parabolicdiff(G,7)*samplerate,
Hv=parabolicdiff(H,7)*samplerate,
target.velocity=parabolicdiff(T,7)*samplerate,
time=row_number(),
# gazeshifts=markSaccades(Gv,buffer=5,threshold=30),
gazeshifts=markSaccadesDouble(Gv,threshold1=60,threshold2=15),
headmovement=markSaccadesDouble(Hv,threshold1=15,threshold2=6),
headmovement=replace(headmovement,headmovement<0,0),
gazeshifts=replace(gazeshifts,gazeshifts<0,0)) %>%
markTagetMovements(buffer=200,threshold=1000,saccade.length=500) %>%
group_by(sacnum) %>%
mutate(firstshift=min(gazeshifts[counter>220&gazeshifts>0],na.rm=T),
gazeshifts=replace(gazeshifts,
gazeshifts!=firstshift|is.na(firstshift),
0),
gazeshifts=replace(gazeshifts,gazeshifts==0,NA),
headmovement=replace(headmovement,headmovement==0,NA),
counter=counter-200)->
hh
hh %>%
group_by(sacnum) %>%
mutate(gvsd=round(sd(Gv[1:300])))->
hh
hh %>%
# filter(sacnum==10)%>%
group_by(sacnum) %>%
mutate(gaze.dur=length(counter[!is.na(gazeshifts)])) %>%
ungroup() %>%
filter(gaze.dur>5) ->
hint
manipulate(ggplot(filter(hh,sacnum==chosensac))+
geom_line(aes(counter,H),color='blue')+
# geom_line(aes(counter,Ef),color='red')+
geom_line(aes(counter,G),color='darkgreen')+
geom_line(aes(counter,T),size=2,alpha=0.5)+
geom_line(aes(counter,Hv/10),color='blue',linetype=2)+
# geom_line(aes(counter,EV/10),color='red')+
geom_line(aes(counter,Gv/10),color='darkgreen',linetype=2)+
# geom_text(x=0,y=50,aes(label=round(sd(Gv),2)))+
# geom_text(x=0,y=60,aes(label=firstshift[1]))+
geom_point(aes(counter,sign(gazeshifts)*50))+
geom_point(aes(counter,sign(headmovement)*25),color='blue')
,
chosensac=slider(1,length(unique(hh$sacnum))))
manipulate(ggplot(filter(hh,sacnum==chosensac))+
geom_line(aes(counter,H),color='blue')+
# geom_line(aes(counter,Ef),color='red')+
geom_line(aes(counter,G),color='darkgreen')+
geom_line(aes(counter,T),size=2,alpha=0.5)+
geom_line(aes(counter,Hv/10),color='blue',linetype=2)+
# geom_line(aes(counter,EV/10),color='red')+
geom_line(aes(counter,Gv/10),color='darkgreen',linetype=2)+
# geom_text(x=0,y=50,aes(label=round(sd(Gv),2)))+
# geom_text(x=0,y=60,aes(label=firstshift[1]))+
geom_point(aes(counter,sign(gazeshifts)*Gv/10))+
geom_point(aes(counter,sign(headmovement)*25),color='blue')
,
chosensac=slider(1,length(unique(hh$sacnum))))
manipulate(ggplot(filter(hh,sacnum==chosensac))+
geom_line(aes(counter,H),color='blue')+
# geom_line(aes(counter,Ef),color='red')+
geom_line(aes(counter,G),color='darkgreen')+
geom_line(aes(counter,T),size=2,alpha=0.5)+
geom_line(aes(counter,Hv/10),color='blue',linetype=2)+
# geom_line(aes(counter,EV/10),color='red')+
geom_line(aes(counter,Gv/10),color='darkgreen',linetype=2)+
# geom_text(x=0,y=50,aes(label=round(sd(Gv),2)))+
# geom_text(x=0,y=60,aes(label=firstshift[1]))+
geom_line(aes(counter,sign(gazeshifts)*Gv/10),size=2,color='green')+
geom_point(aes(counter,sign(headmovement)*25),color='blue')
,
chosensac=slider(1,length(unique(hh$sacnum))))
manipulate(ggplot(filter(hh,sacnum==chosensac))+
geom_line(aes(counter,H),color='blue')+
# geom_line(aes(counter,Ef),color='red')+
geom_line(aes(counter,G),color='darkgreen')+
geom_line(aes(counter,T),size=2,alpha=0.5)+
geom_line(aes(counter,Hv/10),color='blue',linetype=2)+
# geom_line(aes(counter,EV/10),color='red')+
geom_line(aes(counter,Gv/10),color='darkgreen',linetype=2)+
# geom_text(x=0,y=50,aes(label=round(sd(Gv),2)))+
# geom_text(x=0,y=60,aes(label=firstshift[1]))+
geom_line(aes(counter,sign(gazeshifts)*Gv/10),size=2,color='green')+
geom_line(aes(counter,sign(headmovement)*Hv/10),color='blue',size=2)
,
chosensac=slider(1,length(unique(hh$sacnum))))
manipulate(ggplot(filter(hh,sacnum==chosensac))+
geom_line(aes(counter,H),color='blue')+
# geom_line(aes(counter,Ef),color='red')+
geom_line(aes(counter,G),color='darkgreen')+
geom_line(aes(counter,T),size=2,alpha=0.5)+
geom_line(aes(counter,Hv/10),color='blue',linetype=2)+
# geom_line(aes(counter,EV/10),color='red')+
geom_line(aes(counter,Gv/10),color='darkgreen',linetype=2)+
# geom_text(x=0,y=50,aes(label=round(sd(Gv),2)))+
# geom_text(x=0,y=60,aes(label=firstshift[1]))+
geom_line(aes(counter,sign(gazeshifts)*Gv/10),size=2,color='darkgreen')+
geom_line(aes(counter,sign(headmovement)*Hv/10),color='blue',size=2)
,
chosensac=slider(1,length(unique(hh$sacnum))))
head(hh)
saveRDS(hh,'knightdemo.RDS')
h %>%
select(G,H,T) %>% #these are the only data we need
mutate(G=replace(G,G==0,NA), #mark missing data as NA rather than 0
Gv=parabolicdiff(G,7)*samplerate,
Hv=parabolicdiff(H,7)*samplerate,
target.velocity=parabolicdiff(T,7)*samplerate,
time=row_number(),
# gazeshifts=markSaccades(Gv,buffer=5,threshold=30),
gazeshifts=markSaccadesDouble(Gv,threshold1=60,threshold2=15),
headmovement=markSaccadesDouble(Hv,threshold1=15,threshold2=6),
headmovement=replace(headmovement,headmovement<0,0),
gazeshifts=replace(gazeshifts,gazeshifts<0,0)) %>%
markTagetMovements(buffer=200,threshold=1000,saccade.length=500) %>%
group_by(sacnum) %>%
mutate(firstshift=min(gazeshifts[counter>220&gazeshifts>0],na.rm=T),
gazeshifts=replace(gazeshifts,
gazeshifts!=firstshift|is.na(firstshift),
0),
gazeshifts=replace(gazeshifts,gazeshifts==0,NA),
headmovement=replace(headmovement,headmovement==0,NA),
counter=counter-200)->
hh
hh %>%
group_by(sacnum) %>%
mutate(gvsd=round(sd(Gv[1:300])))->
hh
hh %>%
# filter(sacnum==10)%>%
group_by(sacnum) %>%
mutate(gaze.dur=length(counter[!is.na(gazeshifts)])) %>%
ungroup() %>%
filter(gaze.dur>1) ->
hint
h<- read.csv('HEADFREE.txt',sep="\t",header=FALSE)
h<- select(h,-V9)
names(h)<- c('G','GV','H','HV','E','EV','time','T')
h %>%
select(G,H,T) %>% #these are the only data we need
mutate(G=replace(G,G==0,NA), #mark missing data as NA rather than 0
Gv=parabolicdiff(G,7)*samplerate,
Hv=parabolicdiff(H,7)*samplerate,
target.velocity=parabolicdiff(T,7)*samplerate,
time=row_number(),
# gazeshifts=markSaccades(Gv,buffer=5,threshold=30),
gazeshifts=markSaccadesDouble(Gv,threshold1=60,threshold2=15),
headmovement=markSaccadesDouble(Hv,threshold1=15,threshold2=6),
headmovement=replace(headmovement,headmovement<0,0),
gazeshifts=replace(gazeshifts,gazeshifts<0,0)) %>%
markTagetMovements(buffer=200,threshold=1000,saccade.length=500) %>%
group_by(sacnum) %>%
mutate(firstshift=min(gazeshifts[counter>220&gazeshifts>0],na.rm=T),
gazeshifts=replace(gazeshifts,
gazeshifts!=firstshift|is.na(firstshift),
0),
gazeshifts=replace(gazeshifts,gazeshifts==0,NA),
headmovement=replace(headmovement,headmovement==0,NA),
counter=counter-200)->
hh
length(unique(hh$sacnum))
h %>%
select(G,H,T) %>% #these are the only data we need
mutate(G=replace(G,G==0,NA), #mark missing data as NA rather than 0
Gv=parabolicdiff(G,7)*samplerate,
Hv=parabolicdiff(H,7)*samplerate,
target.velocity=parabolicdiff(T,7)*samplerate,
time=row_number(),
# gazeshifts=markSaccades(Gv,buffer=5,threshold=30),
gazeshifts=markSaccadesDouble(Gv,threshold1=60,threshold2=15),
headmovement=markSaccadesDouble(Hv,threshold1=15,threshold2=6),
headmovement=replace(headmovement,headmovement<0,0),
gazeshifts=replace(gazeshifts,gazeshifts<0,0)) %>%
markTagetMovements(buffer=200,threshold=1000,saccade.length=500) ->
htest
unique(htest$sacnum)
h %>%
select(G,H,T) %>% #these are the only data we need
mutate(G=replace(G,G==0,NA), #mark missing data as NA rather than 0
Gv=parabolicdiff(G,7)*samplerate,
Hv=parabolicdiff(H,7)*samplerate,
target.velocity=parabolicdiff(T,7)*samplerate,
time=row_number(),
# gazeshifts=markSaccades(Gv,buffer=5,threshold=30),
gazeshifts=markSaccadesDouble(Gv,threshold1=60,threshold2=15),
headmovement=markSaccadesDouble(Hv,threshold1=15,threshold2=6),
headmovement=replace(headmovement,headmovement<0,0),
gazeshifts=replace(gazeshifts,gazeshifts<0,0)) %>%
markTagetMovements(buffer=200,threshold=200,saccade.length=500) ->
htest
unique(htest$sacnum)
htest%>%
group_by(sacnum) %>%
mutate(firstshift=min(gazeshifts[counter>220&gazeshifts>0],na.rm=T),
gazeshifts=replace(gazeshifts,
gazeshifts!=firstshift|is.na(firstshift),
0),
gazeshifts=replace(gazeshifts,gazeshifts==0,NA),
headmovement=replace(headmovement,headmovement==0,NA),
counter=counter-200)->
hh
hh %>%
group_by(sacnum) %>%
mutate(gvsd=round(sd(Gv[1:300])))->
hh
manipulate(ggplot(filter(hh,sacnum==chosensac))+
geom_line(aes(counter,H),color='blue')+
# geom_line(aes(counter,Ef),color='red')+
geom_line(aes(counter,G),color='darkgreen')+
geom_line(aes(counter,T),size=2,alpha=0.5)+
geom_line(aes(counter,Hv/10),color='blue',linetype=2)+
# geom_line(aes(counter,EV/10),color='red')+
geom_line(aes(counter,Gv/10),color='darkgreen',linetype=2)+
# geom_text(x=0,y=50,aes(label=round(sd(Gv),2)))+
# geom_text(x=0,y=60,aes(label=firstshift[1]))+
geom_line(aes(counter,sign(gazeshifts)*Gv/10),size=2,color='darkgreen')+
geom_line(aes(counter,sign(headmovement)*Hv/10),color='blue',size=2)
,
chosensac=slider(1,length(unique(hh$sacnum))))
saveRDS(hh,'knightdemo.RDS')
apt<-c(1,2,3,4,NA,NA,7,8,9,10)
approx(apt)
h %>%
select(G,H,T) %>% #these are the only data we need
mutate(G=replace(G,G==0,NA), #mark missing data as NA rather than 0
G=na.approx(G),
Gv=parabolicdiff(G,7)*samplerate,
Hv=parabolicdiff(H,7)*samplerate,
target.velocity=parabolicdiff(T,7)*samplerate,
time=row_number(),
# gazeshifts=markSaccades(Gv,buffer=5,threshold=30),
gazeshifts=markSaccadesDouble(Gv,threshold1=60,threshold2=15),
headmovement=markSaccadesDouble(Hv,threshold1=15,threshold2=6),
headmovement=replace(headmovement,headmovement<0,0),
gazeshifts=replace(gazeshifts,gazeshifts<0,0)) %>%
markTagetMovements(buffer=200,threshold=200,saccade.length=500) ->
htest
install.packages('zoo')
library(zoo)
h %>%
select(G,H,T) %>% #these are the only data we need
mutate(G=replace(G,G==0,NA), #mark missing data as NA rather than 0
G=na.approx(G),
Gv=parabolicdiff(G,7)*samplerate,
Hv=parabolicdiff(H,7)*samplerate,
target.velocity=parabolicdiff(T,7)*samplerate,
time=row_number(),
# gazeshifts=markSaccades(Gv,buffer=5,threshold=30),
gazeshifts=markSaccadesDouble(Gv,threshold1=60,threshold2=15),
headmovement=markSaccadesDouble(Hv,threshold1=15,threshold2=6),
headmovement=replace(headmovement,headmovement<0,0),
gazeshifts=replace(gazeshifts,gazeshifts<0,0)) %>%
markTagetMovements(buffer=200,threshold=200,saccade.length=500) ->
htest
?na.approx
na.approx(spt)
na.approx(apt)
G<-h$G
G<- replace(G,G==0,NA)
Ga<-na.approx(G)
head(G)
head(Ga)
tail(G)
tail(Ga)
nrow(h)
h$G<- replace(h$G,h$G==0,NA)
h$G<- na.approx(h$G)
G<- replace(h$G,h$G==0,NA)
G<- na.approx(G)
h$G<- G
length(G)
h %>%
select(G,H,T) %>% #these are the only data we need
mutate(G=replace(G,G==0,NA), #mark missing data as NA rather than 0
G=na.approx(G,na.rm=FALSE),
Gv=parabolicdiff(G,7)*samplerate,
Hv=parabolicdiff(H,7)*samplerate,
target.velocity=parabolicdiff(T,7)*samplerate,
time=row_number(),
# gazeshifts=markSaccades(Gv,buffer=5,threshold=30),
gazeshifts=markSaccadesDouble(Gv,threshold1=60,threshold2=15),
headmovement=markSaccadesDouble(Hv,threshold1=15,threshold2=6),
headmovement=replace(headmovement,headmovement<0,0),
gazeshifts=replace(gazeshifts,gazeshifts<0,0)) %>%
markTagetMovements(buffer=200,threshold=200,saccade.length=500) ->
htest
htest%>%
group_by(sacnum) %>%
mutate(firstshift=min(gazeshifts[counter>220&gazeshifts>0],na.rm=T),
gazeshifts=replace(gazeshifts,
gazeshifts!=firstshift|is.na(firstshift),
0),
gazeshifts=replace(gazeshifts,gazeshifts==0,NA),
headmovement=replace(headmovement,headmovement==0,NA),
counter=counter-200)->
hh
manipulate(ggplot(filter(hh,sacnum==chosensac))+
geom_line(aes(counter,H),color='blue')+
# geom_line(aes(counter,Ef),color='red')+
geom_line(aes(counter,G),color='darkgreen')+
geom_line(aes(counter,T),size=2,alpha=0.5)+
geom_line(aes(counter,Hv/10),color='blue',linetype=2)+
# geom_line(aes(counter,EV/10),color='red')+
geom_line(aes(counter,Gv/10),color='darkgreen',linetype=2)+
# geom_text(x=0,y=50,aes(label=round(sd(Gv),2)))+
# geom_text(x=0,y=60,aes(label=firstshift[1]))+
geom_line(aes(counter,sign(gazeshifts)*Gv/10),size=2,color='darkgreen')+
geom_line(aes(counter,sign(headmovement)*Hv/10),color='blue',size=2)
,
chosensac=slider(1,length(unique(hh$sacnum))))
h<- read.csv('HEADFREE.txt',sep="\t",header=FALSE)
h<- select(h,-V9)
names(h)<- c('G','GV','H','HV','E','EV','time','T')
h %>%
select(G,H,T) %>% #these are the only data we need
mutate(G=replace(G,G==0,NA), #mark missing data as NA rather than 0
#G=na.approx(G,na.rm=FALSE),
Gv=parabolicdiff(G,7)*samplerate,
Hv=parabolicdiff(H,7)*samplerate,
target.velocity=parabolicdiff(T,7)*samplerate,
time=row_number(),
# gazeshifts=markSaccades(Gv,buffer=5,threshold=30),
gazeshifts=markSaccadesDouble(Gv,threshold1=60,threshold2=15),
headmovement=markSaccadesDouble(Hv,threshold1=15,threshold2=6),
headmovement=replace(headmovement,headmovement<0,0),
gazeshifts=replace(gazeshifts,gazeshifts<0,0)) %>%
markTagetMovements(buffer=200,threshold=200,saccade.length=500) ->
htest
htest%>%
group_by(sacnum) %>%
mutate(firstshift=min(gazeshifts[counter>220&gazeshifts>0],na.rm=T),
gazeshifts=replace(gazeshifts,
gazeshifts!=firstshift|is.na(firstshift),
0),
gazeshifts=replace(gazeshifts,gazeshifts==0,NA),
headmovement=replace(headmovement,headmovement==0,NA),
counter=counter-200)->
hh
manipulate(ggplot(filter(hh,sacnum==chosensac))+
geom_line(aes(counter,H),color='blue')+
# geom_line(aes(counter,Ef),color='red')+
geom_line(aes(counter,G),color='darkgreen')+
geom_line(aes(counter,T),size=2,alpha=0.5)+
geom_line(aes(counter,Hv/10),color='blue',linetype=2)+
# geom_line(aes(counter,EV/10),color='red')+
geom_line(aes(counter,Gv/10),color='darkgreen',linetype=2)+
# geom_text(x=0,y=50,aes(label=round(sd(Gv),2)))+
# geom_text(x=0,y=60,aes(label=firstshift[1]))+
geom_line(aes(counter,sign(gazeshifts)*Gv/10),size=2,color='darkgreen')+
geom_line(aes(counter,sign(headmovement)*Hv/10),color='blue',size=2)
,
chosensac=slider(1,length(unique(hh$sacnum))))
h %>%
select(G,H,T) %>% #these are the only data we need
mutate(G=replace(G,G==0,NA), #mark missing data as NA rather than 0
#G=na.approx(G,na.rm=FALSE),
Gv=parabolicdiff(G,7)*samplerate,
Hv=parabolicdiff(H,7)*samplerate,
target.velocity=parabolicdiff(T,7)*samplerate,
time=row_number(),
# gazeshifts=markSaccades(Gv,buffer=5,threshold=30),
gazeshifts=markSaccadesDouble(Gv,threshold1=60,threshold2=10),
headmovement=markSaccadesDouble(Hv,threshold1=10,threshold2=4),
headmovement=replace(headmovement,headmovement<0,0),
gazeshifts=replace(gazeshifts,gazeshifts<0,0)) %>%
markTagetMovements(buffer=200,threshold=200,saccade.length=500) ->
htest
htest%>%
group_by(sacnum) %>%
mutate(firstshift=min(gazeshifts[counter>220&gazeshifts>0],na.rm=T),
gazeshifts=replace(gazeshifts,
gazeshifts!=firstshift|is.na(firstshift),
0),
gazeshifts=replace(gazeshifts,gazeshifts==0,NA),
headmovement=replace(headmovement,headmovement==0,NA),
counter=counter-200)->
hh
manipulate(ggplot(filter(hh,sacnum==chosensac))+
geom_line(aes(counter,H),color='blue')+
# geom_line(aes(counter,Ef),color='red')+
geom_line(aes(counter,G),color='darkgreen')+
geom_line(aes(counter,T),size=2,alpha=0.5)+
geom_line(aes(counter,Hv/10),color='blue',linetype=2)+
# geom_line(aes(counter,EV/10),color='red')+
geom_line(aes(counter,Gv/10),color='darkgreen',linetype=2)+
# geom_text(x=0,y=50,aes(label=round(sd(Gv),2)))+
# geom_text(x=0,y=60,aes(label=firstshift[1]))+
geom_line(aes(counter,sign(gazeshifts)*Gv/10),size=2,color='darkgreen')+
geom_line(aes(counter,sign(headmovement)*Hv/10),color='blue',size=2)
,
chosensac=slider(1,length(unique(hh$sacnum))))
h %>%
select(G,H,T) %>% #these are the only data we need
mutate(G=replace(G,G==0,NA), #mark missing data as NA rather than 0
#G=na.approx(G,na.rm=FALSE),
Gv=parabolicdiff(G,7)*samplerate,
Hv=parabolicdiff(H,7)*samplerate,
target.velocity=parabolicdiff(T,7)*samplerate,
time=row_number(),
# gazeshifts=markSaccades(Gv,buffer=5,threshold=30),
gazeshifts=markSaccadesDouble(Gv,threshold1=100,threshold2=10),
headmovement=markSaccadesDouble(Hv,threshold1=10,threshold2=4),
headmovement=replace(headmovement,headmovement<0,0),
gazeshifts=replace(gazeshifts,gazeshifts<0,0)) %>%
markTagetMovements(buffer=200,threshold=200,saccade.length=500) ->
htest
htest%>%
group_by(sacnum) %>%
mutate(firstshift=min(gazeshifts[counter>220&gazeshifts>0],na.rm=T),
gazeshifts=replace(gazeshifts,
gazeshifts!=firstshift|is.na(firstshift),
0),
gazeshifts=replace(gazeshifts,gazeshifts==0,NA),
headmovement=replace(headmovement,headmovement==0,NA),
counter=counter-200)->
hh
manipulate(ggplot(filter(hh,sacnum==chosensac))+
geom_line(aes(counter,H),color='blue')+
# geom_line(aes(counter,Ef),color='red')+
geom_line(aes(counter,G),color='darkgreen')+
geom_line(aes(counter,T),size=2,alpha=0.5)+
geom_line(aes(counter,Hv/10),color='blue',linetype=2)+
# geom_line(aes(counter,EV/10),color='red')+
geom_line(aes(counter,Gv/10),color='darkgreen',linetype=2)+
# geom_text(x=0,y=50,aes(label=round(sd(Gv),2)))+
# geom_text(x=0,y=60,aes(label=firstshift[1]))+
geom_line(aes(counter,sign(gazeshifts)*Gv/10),size=2,color='darkgreen')+
geom_line(aes(counter,sign(headmovement)*Hv/10),color='blue',size=2)
,
chosensac=slider(1,length(unique(hh$sacnum))))
saveRDS(hh,'knightdemo.RDS')
