ylab('')
manipulate({
d=filter(z,sacnum==goodsacs[currentsac])
ggplot(d)+
geom_point(aes(time,showrasters+30),shape='|',size=4)+
# geom_point(aes(time,showenhance*verg.velocity),color='magenta')+
# geom_area(aes(time,sdf),color='black',fill='pink',alpha=1/10)+
# geom_line(aes(time,slowpredict),color='orange')+
geom_line(aes(time,verg.angle*10+0),color='darkgreen')+
# geom_line(aes(time,predP/1000),color='darkgreen',linetype=2)+
geom_line(aes(time,predV),color='orange')+
# geom_line(aes(time,predV2),color='magenta')+
geom_line(aes(time,verg.velocity),color='darkblue')+
geom_area(aes(time,conj.velocity),alpha=1/3)+
geom_line(aes(time,cumsum(predV)/100+first(verg.angle)*10),color='orange',linetype=2)+
# geom_line(aes(time,verg.velocity-predV),color='red',linetype=2)
ylim(c(NA,150))+
geom_point(aes(time,saccadic*50))
# geom_line(aes(time,target.verg*10))
# geom_line(aes(time,(target.verg-verg.angle)*10),color='hotpink')
},
currentsac=slider(1,length(goodsacs),step=1,initial = 1))
window=51700 #Bee-211
ggplot(filter(d,time>=window,time<window+window_size))+
geom_line(aes(time,((lep-rep)-(lep-rep)[1])*5+15+150),color='darkgreen',size=1)+
geom_line(aes(time,(rep-rep[1])*5+150),color='red',size=1)+
geom_line(aes(time,(lep-lep[1])*5+150),color='blue',size=1)+
geom_line(aes(time,(((repV+lepV)/2)-((repV+lepV)/2)[1])*5+150-15),color='violet',size=1)+
geom_line(aes(time,verg.velocity*2+100),color='blue',alpha=1)+
geom_line(aes(time,predV*2+100),color='orange')+
geom_area(aes(time,sdf/2),alpha=1)+
geom_point(aes(time,showrasters+5),shape='|',color='lightgrey',size=3)+
annotate('segment',x=window,xend=window,y=0,yend=50)+
annotate('text',x=window,y=45,label='100 spk/s')+
annotate('segment',x=window,xend=window,y=100,yend=120)+
annotate('text',x=window,y=114,label='10 deg/s')+
annotate('segment',x=window,xend=window,y=150,yend=175)+
annotate('text',x=window,y=170,label='5 deg')+
annotate('segment',x=window,xend=window+100,y=75,yend=75)+
annotate('text',x=window,y=75,label='100 ms')+
theme_minimal()+
ylab('')
window=51000 #Bee-211
ggplot(filter(d,time>=window,time<window+window_size))+
geom_line(aes(time,((lep-rep)-(lep-rep)[1])*5+15+150),color='darkgreen',size=1)+
geom_line(aes(time,(rep-rep[1])*5+150),color='red',size=1)+
geom_line(aes(time,(lep-lep[1])*5+150),color='blue',size=1)+
geom_line(aes(time,(((repV+lepV)/2)-((repV+lepV)/2)[1])*5+150-15),color='violet',size=1)+
geom_line(aes(time,verg.velocity*2+100),color='blue',alpha=1)+
geom_line(aes(time,predV*2+100),color='orange')+
geom_area(aes(time,sdf/2),alpha=1)+
geom_point(aes(time,showrasters+5),shape='|',color='lightgrey',size=3)+
annotate('segment',x=window,xend=window,y=0,yend=50)+
annotate('text',x=window,y=45,label='100 spk/s')+
annotate('segment',x=window,xend=window,y=100,yend=120)+
annotate('text',x=window,y=114,label='10 deg/s')+
annotate('segment',x=window,xend=window,y=150,yend=175)+
annotate('text',x=window,y=170,label='5 deg')+
annotate('segment',x=window,xend=window+100,y=75,yend=75)+
annotate('text',x=window,y=75,label='100 ms')+
theme_minimal()+
ylab('')
window=543500
ggplot(filter(d,time>=window,time<window+window_size))+
geom_line(aes(time,((lep-rep)-(lep-rep)[1])*5+15+150),color='darkgreen',size=1)+
geom_line(aes(time,(rep-rep[1])*5+150),color='red',size=1)+
geom_line(aes(time,(lep-lep[1])*5+150),color='blue',size=1)+
geom_line(aes(time,(((repV+lepV)/2)-((repV+lepV)/2)[1])*5+150-15),color='violet',size=1)+
geom_line(aes(time,verg.velocity*2+100),color='blue',alpha=1)+
geom_line(aes(time,predV*2+100),color='orange')+
geom_area(aes(time,sdf/2),alpha=1)+
geom_point(aes(time,showrasters+5),shape='|',color='lightgrey',size=3)+
annotate('segment',x=window,xend=window,y=0,yend=50)+
annotate('text',x=window,y=45,label='100 spk/s')+
annotate('segment',x=window,xend=window,y=100,yend=120)+
annotate('text',x=window,y=114,label='10 deg/s')+
annotate('segment',x=window,xend=window,y=150,yend=175)+
annotate('text',x=window,y=170,label='5 deg')+
annotate('segment',x=window,xend=window+100,y=75,yend=75)+
annotate('text',x=window,y=75,label='100 ms')+
theme_minimal()+
ylab('')
window=467500
ggplot(filter(d,time>=window,time<window+window_size))+
geom_line(aes(time,((lep-rep)-(lep-rep)[1])*5+15+150),color='darkgreen',size=1)+
geom_line(aes(time,(rep-rep[1])*5+150),color='red',size=1)+
geom_line(aes(time,(lep-lep[1])*5+150),color='blue',size=1)+
geom_line(aes(time,(((repV+lepV)/2)-((repV+lepV)/2)[1])*5+150-15),color='violet',size=1)+
geom_line(aes(time,verg.velocity*2+100),color='blue',alpha=1)+
geom_line(aes(time,predV*2+100),color='orange')+
geom_area(aes(time,sdf/2),alpha=1)+
geom_point(aes(time,showrasters+5),shape='|',color='lightgrey',size=3)+
annotate('segment',x=window,xend=window,y=0,yend=50)+
annotate('text',x=window,y=45,label='100 spk/s')+
annotate('segment',x=window,xend=window,y=100,yend=120)+
annotate('text',x=window,y=114,label='10 deg/s')+
annotate('segment',x=window,xend=window,y=150,yend=175)+
annotate('text',x=window,y=170,label='5 deg')+
annotate('segment',x=window,xend=window+100,y=75,yend=75)+
annotate('text',x=window,y=75,label='100 ms')+
theme_minimal()+
ylab('')
head(t)
b<- mutate(t,sdf20=lag(sdf,20))
VAF()
VAF<- function(mod,x,param='verg.velocity'){
x<- mutate(x,predV=predict(mod,newdata=x))
1-var(x$predV-x[param],na.rm=T)/var(x[param],na.rm=T)
}
b<- mutate(,saccadic=markSaccades(conj.velocity,buffer=15,threshold=20)>0)
b<- mutate(b,saccadic=markSaccades(conj.velocity,buffer=15,threshold=20)>0)
modfast=lm(sdf20~verg.angle+verg.velocity,data=filter(b,saccadic))
modslow=lm(sdf20~verg.angle+verg.velocity,data=filter(b,!saccadic))
summary(modfast)
summary(modslow)
VAF(modfast)
VAF(modfast,b,'sdf20')
VAF(modslow,b,'sdf20')
modslow=lm(sdf20~verg.angle+verg.velocity,data=filter(b,!saccadic,verg.velocity>0))
VAF(modslow,b,'sdf20')
summary(modfast)
summary(modslow)
VAF(modslow,filter(b,!saccadic),'sdf20')
VAF(modfast,filter(b,saccadic),'sdf20')
compareVAF<- function(x){
x<- mutate(x,sdf20=lag(sdf,20))
x<- mutate(x,saccadic=markSaccades(conj.velocity,buffer=15,threshold=20)>0)
modfast=lm(sdf20~verg.angle+verg.velocity,data=filter(x,saccadic))
modslow=lm(sdf20~verg.angle+verg.velocity,data=filter(x,!saccadic))
result<- c(VAF(modfast,filter(x,saccadic),'sdf20'),
VAF(modslow,filter(x,!saccadic),'sdf20'))
}
compareVAF(b)
result
compareVAF<- function(x){
x<- mutate(x,sdf20=lag(sdf,20))
x<- mutate(x,saccadic=markSaccades(conj.velocity,buffer=15,threshold=20)>0)
modfast=lm(sdf20~verg.angle+verg.velocity,data=filter(x,saccadic))
modslow=lm(sdf20~verg.angle+verg.velocity,data=filter(x,!saccadic))
result<- c(VAF(modfast,filter(x,saccadic),'sdf20'),
VAF(modslow,filter(x,!saccadic),'sdf20'))
result
}
compareVAF(b)
t %>%
group_by(neuron) %>%
do(compareVAF)->
vafcomp
as.data.frame(result)
compareVAF<- function(x){
x<- mutate(x,sdf20=lag(sdf,20))
x<- mutate(x,saccadic=markSaccades(conj.velocity,buffer=15,threshold=20)>0)
modfast=lm(sdf20~verg.angle+verg.velocity,data=filter(x,saccadic))
modslow=lm(sdf20~verg.angle+verg.velocity,data=filter(x,!saccadic))
result<- c(VAF(modfast,filter(x,saccadic),'sdf20'),
VAF(modslow,filter(x,!saccadic),'sdf20'))
as.data.frame(result)
}
t %>%
group_by(neuron) %>%
do(compareVAF)->
vafcomp
compareVAF(b)
result
compareVAF<- function(x){
x<- mutate(x,sdf20=lag(sdf,20))
x<- mutate(x,saccadic=markSaccades(conj.velocity,buffer=15,threshold=20)>0)
modfast=lm(sdf20~verg.angle+verg.velocity,data=filter(x,saccadic))
modslow=lm(sdf20~verg.angle+verg.velocity,data=filter(x,!saccadic))
result<- as.data.frame(fast=VAF(modfast,filter(x,saccadic),'sdf20'),
slow=VAF(modslow,filter(x,!saccadic),'sdf20'))
result
}
t %>%
group_by(neuron) %>%
do(compareVAF)->
vafcomp
compareVAF(b)
compareVAF<- function(x){
x<- mutate(x,sdf20=lag(sdf,20))
x<- mutate(x,saccadic=markSaccades(conj.velocity,buffer=15,threshold=20)>0)
modfast=lm(sdf20~verg.angle+verg.velocity,data=filter(x,saccadic))
modslow=lm(sdf20~verg.angle+verg.velocity,data=filter(x,!saccadic))
result<- as.data.frame(fast=VAF(modfast,filter(x,saccadic),'sdf20'),
slow=VAF(modslow,filter(x,!saccadic),'sdf20'))
result
}
compareVAF(b)
compareVAF<- function(x){
x<- mutate(x,sdf20=lag(sdf,20))
x<- mutate(x,saccadic=markSaccades(conj.velocity,buffer=15,threshold=20)>0)
modfast=lm(sdf20~verg.angle+verg.velocity,data=filter(x,saccadic))
modslow=lm(sdf20~verg.angle+verg.velocity,data=filter(x,!saccadic))
result<- data.frame(fast=VAF(modfast,filter(x,saccadic),'sdf20'),
slow=VAF(modslow,filter(x,!saccadic),'sdf20'))
result
}
compareVAF(b)
data.frame(hello=1,goodbye=2)
VAF<- function(mod,x,param='verg.velocity'){
x<- mutate(x,predV=predict(mod,newdata=x))
result=1-var(x$predV-x[param],na.rm=T)/var(x[param],na.rm=T)
as.numeric(result)
}
compareVAF(b)
t<- readRDS('SOA-NRTP.RDS')
t<- filter(t,cellnum<100)
t %>%
group_by(neuron) %>%
do(compareVAF)->
vafcomp
t %>%
filter(cellnum<103) %>%
group_by(neuron) %>%
do(compareVAF)->
vafcomp
t %>%
filter(cellnum<102) %>%
group_by(neuron) %>%
do(compareVAF)->
vafcomp
t %>%
filter(neuron=='Bee-211') %>%
group_by(neuron) %>%
do(compareVAF)->
vafcomp
b<- filter(t,neuron=='Bee-211')
compareVAF(b)
head(b)
nrow(b)
head(t)
t %>%
filter(neuron=='Bee-101') %>%
group_by(neuron) %>%
do(compareVAF)->
vafcomp
b<- filter(t,neuron=='Bee-101')
head(b)
nrow(b)
nrow(t)
unique(t$neuron)
t<- readRDS('SOA-NRTP.RDS')
t<- filter(t,cellnum>100)
t %>%
filter(neuron=='Bee-101') %>%
group_by(neuron) %>%
do(compareVAF)->
vafcomp
b<- filter(t,neuron=='Bee-101')
compareVAF(b)
t %>%
filter(neuron=='Bee-101') %>%
group_by(neuron) %>%
do(compareVAF(.))->
vafcomp
vafcomp
t %>%
group_by(neuron) %>%
do(compareVAF(.))->
vafcomp
head(vafcomp)
qplot(fast,slow,data=vafcomp)
qplot(fast,slow,data=vafcomp)+geom_abline()
qplot(fast,slow,data=vafcomp)+geom_abline()+geom_text(aes(label=neuron))
compareVAFsingle<- function(x){
x<- mutate(x,sdf20=lag(sdf,20))
x<- mutate(x,saccadic=markSaccades(conj.velocity,buffer=15,threshold=20)>0)
# modfast=lm(sdf20~verg.angle+verg.velocity,data=filter(x,saccadic))
# modslow=lm(sdf20~verg.angle+verg.velocity,data=filter(x,!saccadic))
mod=lm(sdf20~verg.angle+verg.velocity,data=x)
result<- data.frame(fast=VAF(mod,filter(x,saccadic),'sdf20'),
slow=VAF(mod,filter(x,!saccadic),'sdf20'))
result
}
t %>%
group_by(neuron) %>%
do(compareVAFsingle(.))->
vafcompsingle
head(vafcompsingle)
qplot(fast,slow,data=vafcompsingle)+geom_abline()+geom_text(aes(label=neuron))
vafcompsingle %>%
summarize(fastmean=mean(fast),fastsd=sd(fast),slowmean=mean(slow),slowsd=sd(slow))->
vafcompsinglesummary
vafcompsinglesummary
vafcompsingle %>%
ungroup() %>%
summarize(fastmean=mean(fast),fastsd=sd(fast),slowmean=mean(slow),slowsd=sd(slow))->
vafcompsinglesummary
vafcompsinglesummary
z123<- filter(t,neuron=='Ozette-123')
coilnoise<-c(65000:71000,
80500:85000,
95500:98500,
101000:105500,
151500:156000,
187000:191500,
226000:230500,
242000:nrow(z123))
z123[z123$time %in% coilnoise]<- NA
head(z123)
z123[coilnoise]<- NA
z123$coilnoise<-coilnoise
head(coilnoise)
z123 %>%
mutate(time=row_number(),
missingdata=time==coilnoise)->
z123
t<- filter(t,cellnum>100,cellnum != 'Bee-109')
t %>%
group_by(neuron) %>%
do(compareVAFsingle(.))->
vafcompsingle
vafcompsingle %>%
ungroup() %>%
summarize(fastmean=mean(fast),fastsd=sd(fast),slowmean=mean(slow),slowsd=sd(slow))->
vafcompsinglesummary
vafcompsinglesummary
compareVAFsingle(filter(t,neuron=='Bee-211'))
head(b)
b<- mutate(b,saccadic=markSaccades(conj.velocity,buffer=15,threshold=20))
x<- filter(t,neuron=='Bee-211')
x %>%
mutate(saccadic=markSaccades(conj.velocity,buffer=15,threshold=20)) %>%
group_by(saccadic) %>%
mutate(verg.amp=last(verg.angle)-first(verg.angle),
saccadic=saccadic>0)->
x
x %>%
mutate(saccadic=markSaccades(conj.velocity,buffer=15,threshold=20)) %>%
group_by(saccadic) %>%
mutate(verg.amp=last(verg.angle)-first(verg.angle)) %>%
ungroup() %>%
mutate(saccadic=saccadic>0)->
x
head(x)
qplot(unique(x$verg.amp))
compareVAFsinglenoconj<- function(x){
x<- mutate(x,sdf20=lag(sdf,20))
x %>%
mutate(saccadic=markSaccades(conj.velocity,buffer=15,threshold=20)) %>%
group_by(saccadic) %>%
mutate(verg.amp=last(verg.angle)-first(verg.angle)) %>%
ungroup() %>%
mutate(saccadic=saccadic>0)->
x
mod=lm(sdf20~verg.angle+verg.velocity,data=filter(x,verg.amp>1 | !saccadic))
result<- data.frame(fast=VAF(mod,filter(x,saccadic),'sdf20'),
slow=VAF(mod,filter(x,!saccadic),'sdf20'))
result
}
t %>%
group_by(neuron) %>%
do(compareVAFsingle(.))->
vafcompsinglenoconj
vafcompsinglenoconj %>%
ungroup() %>%
summarize(fastmean=mean(fast),fastsd=sd(fast),slowmean=mean(slow),slowsd=sd(slow))->
vafcompsinglenoconjsummary
vafcompsinglenoconjsummary
compareVAFsinglenoconj<- function(x){
x<- mutate(x,sdf20=lag(sdf,20))
x %>%
mutate(saccadic=markSaccades(conj.velocity,buffer=15,threshold=20)) %>%
group_by(saccadic) %>%
mutate(verg.amp=last(verg.angle)-first(verg.angle)) %>%
ungroup() %>%
mutate(saccadic=saccadic>0)->
x
mod=lm(sdf20~verg.angle+verg.velocity,data=filter(x,abs(verg.amp)>1 | !saccadic))
result<- data.frame(fast=VAF(mod,filter(x,saccadic),'sdf20'),
slow=VAF(mod,filter(x,!saccadic),'sdf20'))
result
}
t %>%
group_by(neuron) %>%
do(compareVAFsingle(.))->
vafcompsinglenoconj
vafcompsinglenoconj %>%
ungroup() %>%
summarize(fastmean=mean(fast),fastsd=sd(fast),slowmean=mean(slow),slowsd=sd(slow))->
vafcompsinglenoconjsummary
vafcompsinglenoconjsummary
head(t)
names(t$neuron)
unique(t$neuron)
b<- filter(t,neuron=='Bee-211')
mod<- lm(sdf20~verg.velocity+verg.angle,data=b)
b<- mutate(b,sdf20=lag(sdf,20))
mod<- lm(sdf20~verg.velocity+verg.angle,data=b)
VAF(mod,b,'sdf20')
summary(mod)
result<- data.frame(fast=VAF(mod,filter(x,saccadic),'sdf20'),
slow=VAF(mod,filter(x,!saccadic),'sdf20'),
all=VAF(mod,x,'sdf20'))
t %>%
group_by(neuron) %>%
do(compareVAFsingle(.))->
vafcompsingle
vafcompsingle %>%
ungroup() %>%
summarize(fastmean=mean(fast),fastsd=sd(fast),slowmean=mean(slow),slowsd=sd(slow))->
vafcompsinglesummary
summary(vafcomposinglesummary)
vafcompsinglesummary
vafcompsingle %>%
ungroup() %>%
summarize(fastmean=mean(fast),
fastsd=sd(fast),
slowmean=mean(slow),
slowsd=sd(slow),
allmean=mean(all),
allsd=sd(all))->
vafcompsinglesummary
vafcompsingle %>%
ungroup() %>%
summarize(fastmean=mean(fast),
fastsd=sd(fast),
slowmean=mean(slow),
slowsd=sd(slow),
allmean=mean(all),
allsd=sd(all))->
vafcompsinglesummary
head(vafcompsingle)
compareVAFsingle<- function(x){
x<- mutate(x,sdf20=lag(sdf,20))
x<- mutate(x,saccadic=markSaccades(conj.velocity,buffer=15,threshold=20)>0)
# modfast=lm(sdf20~verg.angle+verg.velocity,data=filter(x,saccadic))
# modslow=lm(sdf20~verg.angle+verg.velocity,data=filter(x,!saccadic))
mod=lm(sdf20~verg.angle+verg.velocity,data=x)
result<- data.frame(fast=VAF(mod,filter(x,saccadic),'sdf20'),
slow=VAF(mod,filter(x,!saccadic),'sdf20'),
all=VAF(mod,x,'sdf20'))
result
}
t %>%
group_by(neuron) %>%
do(compareVAFsingle(.))->
vafcompsingle
head(vafcompsingle)
vafcompsingle %>%
ungroup() %>%
summarize(fastmean=mean(fast),
fastsd=sd(fast),
slowmean=mean(slow),
slowsd=sd(slow),
allmean=mean(all),
allsd=sd(all))->
vafcompsinglesummary
vafcompsinglesummary
vafcompsingle<- mutate(vafcompsingle,prefers.slow=slow>fast)
filter(vafcompsingle,!prefers.slow)
nrow(filter(vafcompsingle,prefers.slow))
sm<- read.csv('simplemodel.csv')
head(sm)
summary(sm)
summary(abs(sm$verg.velocity))
sd(abs(sm$verg.velocity))
compareVAFcomplex<- function(x){
x<- mutate(x,sdf20=lag(sdf,20))
x<- mutate(x,saccadic=markSaccades(conj.velocity,buffer=15,threshold=20)>0)
# modfast=lm(sdf20~verg.angle+verg.velocity,data=filter(x,saccadic))
# modslow=lm(sdf20~verg.angle+verg.velocity,data=filter(x,!saccadic))
mod=lm(sdf20~verg.angle+verg.velocity:saccadic,data=x)
result<- data.frame(complex=VAF(mod,x,'sdf20'))
result
}
t %>%
group_by(neuron) %>%
do(compareVAFcomplex(.))->
vafcomplex
vafcomplex %>%
ungroup() %>%
summarize(fastmean=mean(fast),fastsd=sd(fast),slowmean=mean(slow),slowsd=sd(slow))->
vafcomplexsummary
vafcomplexsummary
vafcomplex %>%
ungroup() %>%
summarize(mean.complex=mean(complex),
sd.complex=sd(complex))->
vafcomplexsummary
vafcomplexsummary
unique(t$neuron)
t<- filter(t,cellnum>100,cellnum != 'Bee-109')
t %>%
group_by(neuron) %>%
do(compareVAFcomplex(.))->
vafcomplex
vafcomplex %>%
ungroup() %>%
summarize(mean.complex=mean(complex),
sd.complex=sd(complex))->
vafcomplexsummary
vafcomplexsummary
c<- read.csv('BootstrapSaccadesComplexModel.csv')
head(c)
filter(c,overlap)
nrow(filter(c,overlap))
nrow(filter(c,!overlap))
nrow(filter(c,!overlap,fast>slow))
nrow(filter(c,!overlap,slow>fast))
nrow(filter(c,!overlap,abs(fast)>abs(slow)))
nrow(filter(c,!overlap,abs(slow)>abs(fast)))
nrow(filter(c,!overlap,fast*slow<1))
nrow(filter(c,!overlap,(fast.low*fast.high)<0))
nrow(filter(c,!overlap,fast.low<0)
nrow(filter(c,!overlap,fast.low<0))
filter(c,!overlap,fast.low<0)
nrow(filter(c,!overlap,(slow.low*slow.high)<0))
nrow(filter(c,(slow.low*slow.high)<0))
nrow(filter(c,(fast.low*fast.high)<0))
max(filter(c,overlap)$fast)
max(filter(c,overlap)$slow)
