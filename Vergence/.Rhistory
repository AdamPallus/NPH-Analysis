summarize(
low=quantile(estimate, alpha / 2),
high=quantile(estimate, 1 - alpha / 2),
m=first(estimate)) ->
ci
ci$neuron<- neuron
return(ci)
}
bootciNOCONJ <- function(t,n=100,alpha=0.05,formula='lagsdf~rev+lev'){
neuron=t$neuron[1]
message(paste('Currently working on',neuron))
t %>%
ungroup() %>%
filter(saccade.type != 'conj') %>%
bootstrap(n) %>%
do(tidy(lm(formula,.)))%>%
group_by(term) %>%
summarize(
low=quantile(estimate, alpha / 2),
high=quantile(estimate, 1 - alpha / 2),
m=first(estimate)) ->
ci
ci$neuron<- neuron
return(ci)
}
joinsaccadesuniform<-function(t,buffer=20,threshold=30,saccade.length=150){
findSaccades<-function(ev,threshold=40){
mindur<-50
i<-which(abs(ev)>threshold) #find all the times when speed > threshold
sacoff<-which(diff(i)>mindur) #minimum duration of an accepted saccade
sacon<-c(1,sacoff+1) #first saccade
sacoff<-c(sacoff,length(i)) #end of last saccade
saccade.onset<-i[sacon] #get actual times
saccade.offset<-i[sacoff]
return(data.frame(saccade.onset,saccade.offset))
}
jsac<- function(stimes){
summary(stimes)
#input should be an array of length 2: c(onsettime,offsettime, saccade.number,saccade.dur)
df<- data.frame(time=stimes[[1]]:stimes[[2]])
df$sacnum<- stimes[[4]]
df$saccade.dur<- stimes[[3]]
return(df)
# return(stimes[[1]]:stimes[[2]])
}
stimes<-findSaccades(t$conj.velocity,threshold)
stimes %>%
mutate(dur=saccade.offset-saccade.onset,
s=row_number(),
saccade.onset=saccade.onset-buffer,
###########HERE IS WHERE i MAKE SACCADES UNIFORM #######
saccade.offset=saccade.onset+saccade.length+2*buffer)->
stimes
x<- do.call('rbind',apply(stimes,1,jsac))
x %>%
group_by(sacnum) %>%
mutate(counter=time-first(time)) ->
x
left_join(t,x,by='time')
}
joinsaccades<-function(t,buffer=20,threshold=30){
findSaccades<-function(ev,threshold=40){
mindur<-50
i<-which(abs(ev)>threshold) #find all the times when speed > threshold
sacoff<-which(diff(i)>mindur) #minimum duration of an accepted saccade
sacon<-c(1,sacoff+1) #first saccade
sacoff<-c(sacoff,length(i)) #end of last saccade
saccade.onset<-i[sacon] #get actual times
saccade.offset<-i[sacoff]
return(data.frame(saccade.onset,saccade.offset))
}
jsac<- function(stimes){
#input should be an array of length 2: c(onsettime,offsettime)
df<- data.frame(time=stimes[[1]]:stimes[[2]])
df$sacnum<- stimes[[3]]
return(df)
# return(stimes[[1]]:stimes[[2]])
}
stimes<-findSaccades(t$conj.velocity,threshold)
stimes %>%
mutate(s=row_number(),
saccade.onset=saccade.onset-buffer,
saccade.offset=saccade.offset+buffer)->
stimes
x<- do.call('rbind',apply(stimes,1,jsac))
x %>%
group_by(sacnum) %>%
mutate(counter=time-first(time)) ->
x
left_join(t,x,by='time')
}
markEnhancement<- function(v, threshold1=15,threshold2=8){
require(dplyr)
mindur<-50
i<-which(abs(v)>threshold2) #find all the times when speed is above the lower threshold
sacoff<-which(diff(i)>mindur) #minimum duration of an accepted saccade
sacon<-c(1,sacoff+1) #first saccade
sacoff<-c(sacoff,length(i)) #end of last saccade
event.onset<-i[sacon] #get actual times
event.offset<-i[sacoff]
stimes<- data.frame(event.onset,event.offset)
nsaccades=nrow(stimes)
jsac<- function(stimes){
summary(stimes)
#input should be an array of length 2: c(onsettime,offsettime, saccade.number,saccade.dur)
df<- data.frame(time=stimes[[1]]:stimes[[2]])
df$enhancenum<- stimes[[4]]
df$enhance.dur<- stimes[[3]]
return(df)
# return(stimes[[1]]:stimes[[2]])
}
stimes %>%
mutate(dur=event.offset-event.onset,
s=row_number())->
stimes
x<- do.call('rbind',apply(stimes,1,jsac))
v<- data.frame(v=v)
v<- mutate(v, time=row_number())
xx<- left_join(v,x,by='time')
xx %>%
group_by(enhancenum) %>%
summarize(max.vel=max(abs(v))) %>%
filter(max.vel>threshold1)->
xm
xx %>%
filter(enhancenum %in% unique(xm$enhancenum)) %>%
dplyr::select(time,v,enhancenum) ->
g
}
mod<- lm('verg.velocity~sdf20+verg.angle',data=filter(x,enhance.type=='none'))
mod2<- lm('verg.velocity~sdf20+verg.angle',data=filter(x,enhance.type=='none',sdf20>30))
summary(mod)
x<- mutate(x,predV=predict(mod,newdata=x),
predV2=predict(mod2,newdata=x),
showrasters=replace(rasters,rasters<1,NA))
window_size=2000
step_size=1000
manipulate(ggplot(filter(x,time>=window,time<window+window_size))+
geom_point(aes(time,showrasters+30),shape='|')+
# geom_line(aes(time,sdf))+
# geom_line(aes(time,slowpredict),color='orange')+
geom_line(aes(time,verg.angle*10+0),color='darkgreen')+
# geom_line(aes(time,predP/1000),color='darkgreen',linetype=2)+
geom_line(aes(time,predV),color='orange')+
geom_line(aes(time,predV2),color='magenta')+
geom_line(aes(time,verg.velocity),color='darkblue')+
geom_line(aes(time,verg.velocity-predV),color='red',linetype=2)
# ylim(c(-10,20))
,
window=slider(window_size,max(x$time-window_size),step=step_size))
library(manipulate)
manipulate(ggplot(filter(x,time>=window,time<window+window_size))+
geom_point(aes(time,showrasters+30),shape='|')+
# geom_line(aes(time,sdf))+
# geom_line(aes(time,slowpredict),color='orange')+
geom_line(aes(time,verg.angle*10+0),color='darkgreen')+
# geom_line(aes(time,predP/1000),color='darkgreen',linetype=2)+
geom_line(aes(time,predV),color='orange')+
geom_line(aes(time,predV2),color='magenta')+
geom_line(aes(time,verg.velocity),color='darkblue')+
geom_line(aes(time,verg.velocity-predV),color='red',linetype=2)
# ylim(c(-10,20))
,
window=slider(window_size,max(x$time-window_size),step=step_size))
x<- ungroup(filter(t,neuron=='Bee-107'))
x %>%
mutate(verg.velocity=parabolicdiff(lep-rep,20),
sdf=spikedensity(rasters,sd=20),
sdf20=lag(sdf,20)) ->
x
mod<- lm('verg.velocity~sdf20+verg.angle',data=filter(x,enhance.type=='none'))
mod2<- lm('verg.velocity~sdf20+verg.angle',data=filter(x,enhance.type=='none',sdf20>30))
summary(mod)
x<- mutate(x,predV=predict(mod,newdata=x),
predV2=predict(mod2,newdata=x),
showrasters=replace(rasters,rasters<1,NA))
window_size=2000
step_size=1000
manipulate(ggplot(filter(x,time>=window,time<window+window_size))+
geom_point(aes(time,showrasters+30),shape='|')+
# geom_line(aes(time,sdf))+
# geom_line(aes(time,slowpredict),color='orange')+
geom_line(aes(time,verg.angle*10+0),color='darkgreen')+
# geom_line(aes(time,predP/1000),color='darkgreen',linetype=2)+
geom_line(aes(time,predV),color='orange')+
geom_line(aes(time,predV2),color='magenta')+
geom_line(aes(time,verg.velocity),color='darkblue')+
geom_line(aes(time,verg.velocity-predV),color='red',linetype=2)
# ylim(c(-10,20))
,
window=slider(window_size,max(x$time-window_size),step=step_size))
manipulate(ggplot(filter(x,time>=window,time<window+window_size))+
geom_point(aes(time,showrasters+30),shape='|')+
geom_line(aes(time,sdf))+
# geom_line(aes(time,slowpredict),color='orange')+
geom_line(aes(time,verg.angle*10+0),color='darkgreen')+
# geom_line(aes(time,predP/1000),color='darkgreen',linetype=2)+
geom_line(aes(time,predV),color='orange')+
geom_line(aes(time,predV2),color='magenta')+
geom_line(aes(time,verg.velocity),color='darkblue')+
geom_line(aes(time,verg.velocity-predV),color='red',linetype=2)
# ylim(c(-10,20))
,
window=slider(window_size,max(x$time-window_size),step=step_size))
parabolicdiff <- function(pos,n=7){
q <- sum(2*((1:n)^2))
convoutput<- rcpp_convolve(pos,c(-n:-1, 1:n))
convoutput<- convoutput[(n*2):(length(pos)-((n*2)+1))]
vels<- c(array(convoutput[1],dim=n*2),convoutput,array(convoutput[length(convoutput)],dim=n*2))
vels <- vels/q*-1000
}
x %>%
mutate(verg.velocity=parabolicdiff(lep-rep,20),
sdf=spikedensity(rasters,sd=20),
sdf20=lag(sdf,20)) ->
x
mod<- lm('verg.velocity~sdf20+verg.angle',data=filter(x,enhance.type=='none'))
mod2<- lm('verg.velocity~sdf20+verg.angle',data=filter(x,enhance.type=='none',sdf20>30))
summary(mod)
x<- mutate(x,predV=predict(mod,newdata=x),
predV2=predict(mod2,newdata=x),
showrasters=replace(rasters,rasters<1,NA))
window_size=2000
step_size=1000
manipulate(ggplot(filter(x,time>=window,time<window+window_size))+
geom_point(aes(time,showrasters+30),shape='|')+
geom_line(aes(time,sdf))+
# geom_line(aes(time,slowpredict),color='orange')+
geom_line(aes(time,verg.angle*10+0),color='darkgreen')+
# geom_line(aes(time,predP/1000),color='darkgreen',linetype=2)+
geom_line(aes(time,predV),color='orange')+
geom_line(aes(time,predV2),color='magenta')+
geom_line(aes(time,verg.velocity),color='darkblue')+
geom_line(aes(time,verg.velocity-predV),color='red',linetype=2)
# ylim(c(-10,20))
,
window=slider(window_size,max(x$time-window_size),step=step_size))
xx <- joinsaccadesuniform(x,buffer=200,threshold=20,saccade.length=150)
p<- filter(xx,r.amp>5)
goodsacs<- unique(p$sacnum.y)
nsac=length(goodsacs)
manipulate(ggplot(filter(xx,sacnum.y==goodsacs[sac]))+
geom_point(aes(time,showrasters+30),shape='|')+
# geom_line(aes(time,sdf))+
# geom_line(aes(time,slowpredict),color='orange')+
geom_line(aes(time,verg.angle*10+0),color='darkgreen')+
# geom_line(aes(time,predP/1000),color='darkgreen',linetype=2)+
geom_line(aes(time,predV),color='orange')+
geom_line(aes(time,predV2),color='magenta')+
geom_line(aes(time,verg.velocity),color='darkblue')+
geom_line(aes(time,verg.velocity-predV),color='red',linetype=2)+
geom_area(aes(time,sdf),alpha=1/10,fill='pink',color='black')
,
sac=slider(2,nsac,step=1))
xx <- joinsaccadesuniform(x,buffer=200,threshold=20,saccade.length=150)
p<- filter(xx,r.amp>5)
names(xx)
t<- readRDS('EnhanceMarkedSOA.RDS')
names9x
names(x)
names(t)
t %>%
group_by(neuron) %>%
mutate(sdf20= lag(sdf,20)) ->
t
t %>% group_by(neuron) %>%
do(joinsaccades(.,buffer=20,threshold=20))->
t
x<- ungroup(filter(t,neuron=='Bee-107'))
x %>%
mutate(verg.velocity=parabolicdiff(lep-rep,20),
sdf=spikedensity(rasters,sd=20),
sdf20=lag(sdf,20)) ->
x
mod<- lm('verg.velocity~sdf20+verg.angle',data=filter(x,enhance.type=='none'))
mod2<- lm('verg.velocity~sdf20+verg.angle',data=filter(x,enhance.type=='none',sdf20>30))
summary(mod)
x<- mutate(x,predV=predict(mod,newdata=x),
predV2=predict(mod2,newdata=x),
showrasters=replace(rasters,rasters<1,NA))
window_size=2000
step_size=1000
manipulate(ggplot(filter(x,time>=window,time<window+window_size))+
geom_point(aes(time,showrasters+30),shape='|')+
geom_line(aes(time,sdf))+
# geom_line(aes(time,slowpredict),color='orange')+
geom_line(aes(time,verg.angle*10+0),color='darkgreen')+
# geom_line(aes(time,predP/1000),color='darkgreen',linetype=2)+
geom_line(aes(time,predV),color='orange')+
geom_line(aes(time,predV2),color='magenta')+
geom_line(aes(time,verg.velocity),color='darkblue')+
geom_line(aes(time,verg.velocity-predV),color='red',linetype=2)
# ylim(c(-10,20))
,
window=slider(window_size,max(x$time-window_size),step=step_size))
xx <- joinsaccadesuniform(x,buffer=200,threshold=20,saccade.length=150)
p<- filter(xx,r.amp>5)
names(xx)
xx %>%
group_by(sacnum) %>%
mutate(conj.h=(lep+rep)/2,
conj.v=(lepV+repV)/2,
conj.h.amp=last(conj.h)-first(conj.h),
conj.v.amp=last(conj.v)-first(conj.v),
conj.angle=atan2(conj.v,conj.h)*180/pi,
peak.verg.velocity=maxabs(verg.velocity),
r.amp=sqrt(conj.h^2+conj.v^2),
verg.amp=last(verg.angle)-first(verg.angle),
saccade.type='conj',
saccade.type=replace(saccade.type,verg.amp< -2 & r.amp>2,'diverging'),
saccade.type=replace(saccade.type,verg.amp> 2& r.amp>2,'converging'),
saccade.type=replace(saccade.type,is.na(sacnum) | r.amp<2,'no.saccade')) ->
xx
t<- readRDS('EnhanceMarkedSOA.RDS')
x<- ungroup(filter(t,neuron=='Bee-107'))
x %>%
mutate(verg.velocity=parabolicdiff(lep-rep,20),
sdf=spikedensity(rasters,sd=20),
sdf20=lag(sdf,20)) ->
x
mod<- lm('verg.velocity~sdf20+verg.angle',data=filter(x,enhance.type=='none'))
mod2<- lm('verg.velocity~sdf20+verg.angle',data=filter(x,enhance.type=='none',sdf20>30))
summary(mod)
x<- mutate(x,predV=predict(mod,newdata=x),
predV2=predict(mod2,newdata=x),
showrasters=replace(rasters,rasters<1,NA))
window_size=2000
step_size=1000
manipulate(ggplot(filter(x,time>=window,time<window+window_size))+
geom_point(aes(time,showrasters+30),shape='|')+
geom_line(aes(time,sdf))+
# geom_line(aes(time,slowpredict),color='orange')+
geom_line(aes(time,verg.angle*10+0),color='darkgreen')+
# geom_line(aes(time,predP/1000),color='darkgreen',linetype=2)+
geom_line(aes(time,predV),color='orange')+
geom_line(aes(time,predV2),color='magenta')+
geom_line(aes(time,verg.velocity),color='darkblue')+
geom_line(aes(time,verg.velocity-predV),color='red',linetype=2)
# ylim(c(-10,20))
,
window=slider(window_size,max(x$time-window_size),step=step_size))
xx <- joinsaccadesuniform(x,buffer=200,threshold=20,saccade.length=150)
xx %>%
group_by(sacnum) %>%
mutate(conj.h=(lep+rep)/2,
conj.v=(lepV+repV)/2,
conj.h.amp=last(conj.h)-first(conj.h),
conj.v.amp=last(conj.v)-first(conj.v),
conj.angle=atan2(conj.v,conj.h)*180/pi,
peak.verg.velocity=maxabs(verg.velocity),
r.amp=sqrt(conj.h^2+conj.v^2),
verg.amp=last(verg.angle)-first(verg.angle),
saccade.type='conj',
saccade.type=replace(saccade.type,verg.amp< -2 & r.amp>2,'diverging'),
saccade.type=replace(saccade.type,verg.amp> 2& r.amp>2,'converging'),
saccade.type=replace(saccade.type,is.na(sacnum) | r.amp<2,'no.saccade')) ->
xx
p<- filter(xx,r.amp>5)
goodsacs<- unique(p$sacnum)
nsac=length(goodsacs)
manipulate(ggplot(filter(xx,sacnum==goodsacs[sac]))+
geom_point(aes(time,showrasters+30),shape='|')+
# geom_line(aes(time,sdf))+
# geom_line(aes(time,slowpredict),color='orange')+
geom_line(aes(time,verg.angle*10+0),color='darkgreen')+
# geom_line(aes(time,predP/1000),color='darkgreen',linetype=2)+
geom_line(aes(time,predV),color='orange')+
geom_line(aes(time,predV2),color='magenta')+
geom_line(aes(time,verg.velocity),color='darkblue')+
geom_line(aes(time,verg.velocity-predV),color='red',linetype=2)+
geom_area(aes(time,sdf),alpha=1/10,fill='pink',color='black')
,
sac=slider(2,nsac,step=1))
manipulate(ggplot(filter(xx,sacnum==goodsacs[sac]))+
geom_point(aes(counter,showrasters+30),shape='|')+
# geom_line(aes(counter,sdf))+
# geom_line(aes(counter,slowpredict),color='orange')+
geom_line(aes(counter,verg.angle*10+0),color='darkgreen')+
# geom_line(aes(counter,predP/1000),color='darkgreen',linetype=2)+
geom_line(aes(counter,predV),color='orange')+
geom_line(aes(counter,predV2),color='magenta')+
geom_line(aes(counter,verg.velocity),color='darkblue')+
geom_line(aes(counter,verg.velocity-predV),color='red',linetype=2)+
geom_area(aes(counter,sdf),alpha=1/10,fill='pink',color='black')
,
sac=slider(2,nsac,step=1))
manipulate(ggplot(filter(xx,sacnum==goodsacs[sac]))+
geom_point(aes(counter,showrasters+30),shape='|')+
# geom_line(aes(counter,sdf))+
# geom_line(aes(counter,slowpredict),color='orange')+
geom_line(aes(counter,verg.angle*10+0),color='darkgreen')+
# geom_line(aes(counter,predP/1000),color='darkgreen',linetype=2)+
geom_line(aes(counter,predV),color='orange')+
geom_line(aes(counter,predV2),color='magenta')+
geom_line(aes(counter,verg.velocity),color='darkblue')+
geom_line(aes(counter,verg.velocity-predV),color='red',linetype=2)+
geom_area(aes(counter,sdf),alpha=1/10,fill='pink',color='black')+
geom_line(aes(counter,rep),color='red')
,
sac=slider(2,nsac,step=1))
manipulate(ggplot(filter(xx,sacnum==goodsacs[sac]))+
geom_point(aes(counter,showrasters+30),shape='|')+
# geom_line(aes(counter,sdf))+
# geom_line(aes(counter,slowpredict),color='orange')+
geom_line(aes(counter,verg.angle*10+0),color='darkgreen')+
# geom_line(aes(counter,predP/1000),color='darkgreen',linetype=2)+
geom_line(aes(counter,predV),color='orange')+
geom_line(aes(counter,predV2),color='magenta')+
geom_line(aes(counter,verg.velocity),color='darkblue')+
geom_line(aes(counter,verg.velocity-predV),color='red',linetype=2)+
geom_area(aes(counter,sdf),alpha=1/10,fill='pink',color='black')+
geom_line(aes(counter,rep),color='red')+
geom_line(aes(counter,repV),color='red',linetype=2)
,
sac=slider(2,nsac,step=1))
manipulate(ggplot(filter(xx,sacnum==goodsacs[sac]))+
geom_point(aes(counter,showrasters+30),shape='|')+
# geom_line(aes(counter,sdf))+
# geom_line(aes(counter,slowpredict),color='orange')+
geom_line(aes(counter,verg.angle*10+0),color='darkgreen')+
# geom_line(aes(counter,predP/1000),color='darkgreen',linetype=2)+
geom_line(aes(counter,predV),color='orange')+
geom_line(aes(counter,predV2),color='magenta')+
geom_line(aes(counter,verg.velocity),color='darkblue')+
geom_line(aes(counter,verg.velocity-predV),color='red',linetype=2)+
geom_area(aes(counter,sdf),alpha=1/10,fill='pink',color='black')+
geom_line(aes(counter,rev),color='red')+
geom_line(aes(counter,revV),color='red',linetype=2)
,
sac=slider(2,nsac,step=1))
x<- ungroup(filter(t,neuron=='Ozette-120'))
x %>%
mutate(verg.velocity=parabolicdiff(lep-rep,20),
sdf=spikedensity(rasters,sd=20),
sdf20=lag(sdf,20)) ->
x
mod<- lm('verg.velocity~sdf20+verg.angle',data=filter(x,enhance.type=='none'))
mod2<- lm('verg.velocity~sdf20+verg.angle',data=filter(x,enhance.type=='none',sdf20>30))
summary(mod)
x<- mutate(x,predV=predict(mod,newdata=x),
predV2=predict(mod2,newdata=x),
showrasters=replace(rasters,rasters<1,NA))
xx <- joinsaccadesuniform(x,buffer=200,threshold=20,saccade.length=150)
xx %>%
group_by(sacnum) %>%
mutate(conj.h=(lep+rep)/2,
conj.v=(lepV+repV)/2,
conj.h.amp=last(conj.h)-first(conj.h),
conj.v.amp=last(conj.v)-first(conj.v),
conj.angle=atan2(conj.v,conj.h)*180/pi,
peak.verg.velocity=maxabs(verg.velocity),
r.amp=sqrt(conj.h^2+conj.v^2),
verg.amp=last(verg.angle)-first(verg.angle),
saccade.type='conj',
saccade.type=replace(saccade.type,verg.amp< -2 & r.amp>2,'diverging'),
saccade.type=replace(saccade.type,verg.amp> 2& r.amp>2,'converging'),
saccade.type=replace(saccade.type,is.na(sacnum) | r.amp<2,'no.saccade')) ->
xx
p<- filter(xx,r.amp>5)
goodsacs<- unique(p$sacnum)
nsac=length(goodsacs)
manipulate(ggplot(filter(xx,sacnum==goodsacs[sac]))+
geom_point(aes(counter,showrasters+30),shape='|')+
# geom_line(aes(counter,sdf))+
# geom_line(aes(counter,slowpredict),color='orange')+
geom_line(aes(counter,verg.angle*10+0),color='darkgreen')+
# geom_line(aes(counter,predP/1000),color='darkgreen',linetype=2)+
geom_line(aes(counter,predV),color='orange')+
geom_line(aes(counter,predV2),color='magenta')+
geom_line(aes(counter,verg.velocity),color='darkblue')+
geom_line(aes(counter,verg.velocity-predV),color='red',linetype=2)+
geom_area(aes(counter,sdf),alpha=1/10,fill='pink',color='black')+
geom_line(aes(counter,rev),color='red')+
geom_line(aes(counter,revV),color='red',linetype=2)
,
sac=slider(2,nsac,step=1))
manipulate(ggplot(filter(xx,sacnum==goodsacs[sac]))+
geom_point(aes(counter,showrasters+30),shape='|')+
geom_line(aes(counter,verg.angle*10+0),color='darkgreen')+
geom_line(aes(counter,predV),color='orange')+
geom_line(aes(counter,predV2),color='magenta')+
geom_line(aes(counter,verg.velocity),color='darkblue')+
geom_line(aes(counter,verg.velocity-predV),color='red',linetype=2)+
geom_area(aes(counter,sdf),alpha=1/10,fill='pink',color='black')
,
sac=slider(2,nsac,step=1))
manipulate(ggplot(filter(x,time>=window,time<window+window_size))+
geom_point(aes(time,showrasters+30),shape='|')+
geom_line(aes(time,sdf))+
# geom_line(aes(time,slowpredict),color='orange')+
geom_line(aes(time,verg.angle*10+0),color='darkgreen')+
# geom_line(aes(time,predP/1000),color='darkgreen',linetype=2)+
geom_line(aes(time,predV),color='orange')+
geom_line(aes(time,predV2),color='magenta')+
geom_line(aes(time,verg.velocity),color='darkblue')+
geom_line(aes(time,verg.velocity-predV),color='red',linetype=2)
# ylim(c(-10,20))
,
window=slider(window_size,max(x$time-window_size),step=step_size))
manipulate(ggplot(filter(x,time>=window,time<window+window_size))+
geom_point(aes(time,showrasters+30),shape='|')+
geom_area(aes(time,sdf),color='black',fill='pink',alpha=1/10)+
# geom_line(aes(time,slowpredict),color='orange')+
geom_line(aes(time,verg.angle*10+0),color='darkgreen')+
# geom_line(aes(time,predP/1000),color='darkgreen',linetype=2)+
geom_line(aes(time,predV),color='orange')+
geom_line(aes(time,predV2),color='magenta')+
geom_line(aes(time,verg.velocity),color='darkblue')+
geom_line(aes(time,verg.velocity-predV),color='red',linetype=2)
# ylim(c(-10,20))
,
window=slider(window_size,max(x$time-window_size),step=step_size))
