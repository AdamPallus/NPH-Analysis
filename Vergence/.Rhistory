instant.dir=atan2(conj.v.vel,conj.h.vel)*180/pi
# target.verg=thp-thp2,
# verg.error=verg.angle-target.verg
)->
x
xm<- group_by(x,time) %>% summarize_each(funs(first))
# x<- mutate(x,saccadic=!is.na(sacnum))
mod<- lm(model.form,data=filter(xm,!saccadic,verg.velocity>0))
# mod<- lm(model.form,data=filter(x,!saccadic))
# mod<- lm(model.form,data=filter(xm,verg.velocity>0))
# mod<-lm(model.form,data=xm)
# mod<- lm(model.form,data=filter(x,!isconj))
if (returnmodel) return(mod)
print(tidy(mod))
# mod2<- lm('verg.velocity~sdf20+verg.angle',data=filter(x,enhance.type=='none',sdf20>30))
message(paste('R-squared =', summary(mod)$r.squared))
# x<- dplyr::select(x,-sacnum,-counter)
x<- mutate(ungroup(x),predV=predict(mod,newdata=x),
showrasters=replace(rasters,rasters<1,NA))
}
bufferlength=200
modelVV2(t,chosenCell='Bee-113',lagsdf=20,
model.form='verg.velocity~sdf20+verg.angle',
# model.form='sdf20~verg.velocity+verg.angle',
saccadebuffer=bufferlength) %>%
group_by(sacnum) %>%
mutate(saccade.dur=n()-2*bufferlength,
saccade.end=saccade.dur+bufferlength,
peak.conj.velocity=maxabs(conj.velocity),
peak.R.H= maxabs(rev),
peak.R.V= maxabs(revV),
peak.L.H= maxabs(lev),
peak.L.V= maxabs(levV),
R.H.Amp=rep[saccade.end]-rep[bufferlength],
L.H.Amp=lep[saccade.end]-lep[bufferlength],
R.V.Amp=repV[saccade.end]-repV[bufferlength],
L.V.Amp=lepV[saccade.end]-lepV[bufferlength],
conj.H.Amp=(R.H.Amp+L.H.Amp)/2,
conj.V.Amp=(R.V.Amp+L.V.Amp)/2,
r.angle=atan2(R.V.Amp,R.H.Amp)*180/pi,
r.amp=sqrt(R.H.Amp^2+R.V.Amp^2),
vect.amp= (sqrt(R.H.Amp^2+R.V.Amp^2)+sqrt(L.H.Amp^2+L.V.Amp^2))/2,
maxamp=max(abs(R.H.Amp),abs(R.V.Amp),abs(L.H.Amp),abs(L.V.Amp)),
saccadic.verg.amp=verg.angle[saccade.end]-verg.angle[bufferlength],
total.verg.amp=sum(verg.velocity)/1000,
mean.verg.amp=mean(verg.angle[saccade.end:n()]-mean(verg.angle[1:bufferlength])),
peak.verg.velocity= maxabs(verg.velocity),
min.verg.trans = min(verg.velocity),
max.verg.trans = max(verg.velocity),
off.verg.velocity=min(abs(min.verg.trans),abs(max.verg.trans)),
min.verg.angle=min(verg.angle),
max.verg.angle=max(verg.angle),
max.verg.velocity=max(verg.velocity),
min.verg.velocity=min(verg.velocity),
initial.verg.angle=verg.angle[bufferlength],
predicted.verg.amp=sum(predV)/1000,
predicted.peak.verg.velocity=maxabs(predV))->
z
window_size=4000
manipulate({
d=filter(z,time>=window,time<window+window_size)
ggplot(d)+
geom_point(aes(time,showrasters+30),shape='|')+
# geom_point(aes(time,showenhance*verg.velocity),color='magenta')+
# geom_line(aes(time,sdf-100),color='hotpink')+
# geom_line(aes(time,slowpredict),color='orange')+
geom_line(aes(time,verg.angle*10+0),color='darkgreen')+
# geom_line(aes(time,predP/1000),color='darkgreen',linetype=2)+
geom_line(aes(time,predV),color='orange')+
# geom_line(aes(time,predV2),color='magenta')+
geom_line(aes(time,verg.velocity),color='darkblue')+
# geom_area(aes(time,conj.velocity),alpha=1/3)+
geom_line(aes(time,sdf),alpha=1/3)+
# geom_line(aes(time,rep*10+200),color='red')+
# geom_line(aes(time,lep*10+200),color='blue')+
# geom_line(aes(time,repV*10+300),color='red')+
# geom_line(aes(time,lepV*10+300),color='blue')+
# geom_line(aes(time,cumsum(predV)/100+first(verg.angle)*10),color='orange',linetype=2)+
# geom_line(aes(time,verg.velocity-predV),color='red',linetype=2)
# ylim(c(NA,150))+
geom_point(aes(time,saccadic*50))
# geom_line(aes(time,target.verg*10))
# geom_line(aes(time,(target.verg-verg.angle)*10),color='hotpink')
},
window_size=slider(1000,5000,step=100,initial = 4000),
window=slider(window_size,max(z$time-window_size),step=4000))
library(manipulate)
manipulate({
d=filter(z,time>=window,time<window+window_size)
ggplot(d)+
geom_point(aes(time,showrasters+30),shape='|')+
# geom_point(aes(time,showenhance*verg.velocity),color='magenta')+
# geom_line(aes(time,sdf-100),color='hotpink')+
# geom_line(aes(time,slowpredict),color='orange')+
geom_line(aes(time,verg.angle*10+0),color='darkgreen')+
# geom_line(aes(time,predP/1000),color='darkgreen',linetype=2)+
geom_line(aes(time,predV),color='orange')+
# geom_line(aes(time,predV2),color='magenta')+
geom_line(aes(time,verg.velocity),color='darkblue')+
# geom_area(aes(time,conj.velocity),alpha=1/3)+
geom_line(aes(time,sdf),alpha=1/3)+
# geom_line(aes(time,rep*10+200),color='red')+
# geom_line(aes(time,lep*10+200),color='blue')+
# geom_line(aes(time,repV*10+300),color='red')+
# geom_line(aes(time,lepV*10+300),color='blue')+
# geom_line(aes(time,cumsum(predV)/100+first(verg.angle)*10),color='orange',linetype=2)+
# geom_line(aes(time,verg.velocity-predV),color='red',linetype=2)
# ylim(c(NA,150))+
geom_point(aes(time,saccadic*50))
# geom_line(aes(time,target.verg*10))
# geom_line(aes(time,(target.verg-verg.angle)*10),color='hotpink')
},
window_size=slider(1000,5000,step=100,initial = 4000),
window=slider(window_size,max(z$time-window_size),step=4000))
manipulate({
d=filter(z,time>=window,time<window+window_size)
ggplot(d)+
geom_point(aes(time,showrasters+30),shape='|')+
# geom_point(aes(time,showenhance*verg.velocity),color='magenta')+
# geom_line(aes(time,sdf-100),color='hotpink')+
# geom_line(aes(time,slowpredict),color='orange')+
geom_line(aes(time,verg.angle*10+0),color='darkgreen')+
# geom_line(aes(time,predP/1000),color='darkgreen',linetype=2)+
geom_line(aes(time,predV),color='orange')+
# geom_line(aes(time,predV2),color='magenta')+
geom_line(aes(time,verg.velocity),color='darkblue')+
# geom_area(aes(time,conj.velocity),alpha=1/3)+
# geom_line(aes(time,sdf),alpha=1/3)+
# geom_line(aes(time,rep*10+200),color='red')+
# geom_line(aes(time,lep*10+200),color='blue')+
# geom_line(aes(time,repV*10+300),color='red')+
# geom_line(aes(time,lepV*10+300),color='blue')+
# geom_line(aes(time,cumsum(predV)/100+first(verg.angle)*10),color='orange',linetype=2)+
# geom_line(aes(time,verg.velocity-predV),color='red',linetype=2)
# ylim(c(NA,150))+
geom_point(aes(time,saccadic*50))
# geom_line(aes(time,target.verg*10))
# geom_line(aes(time,(target.verg-verg.angle)*10),color='hotpink')
},
window_size=slider(1000,5000,step=100,initial = 4000),
window=slider(window_size,max(z$time-window_size),step=4000))
ggplot(d)+
geom_point(aes(time,showrasters+30),shape='|')+
# geom_point(aes(time,showenhance*verg.velocity),color='magenta')+
# geom_line(aes(time,sdf-100),color='hotpink')+
# geom_line(aes(time,slowpredict),color='orange')+
geom_line(aes(time,verg.angle*10+0),color='darkgreen')+
# geom_line(aes(time,predP/1000),color='darkgreen',linetype=2)+
geom_line(aes(time,predV),color='orange')+
# geom_line(aes(time,predV2),color='magenta')+
geom_line(aes(time,verg.velocity),color='darkblue')+
# geom_area(aes(time,conj.velocity),alpha=1/3)+
# geom_line(aes(time,sdf),alpha=1/3)+
# geom_line(aes(time,rep*10+200),color='red')+
# geom_line(aes(time,lep*10+200),color='blue')+
# geom_line(aes(time,repV*10+300),color='red')+
# geom_line(aes(time,lepV*10+300),color='blue')+
# geom_line(aes(time,cumsum(predV)/100+first(verg.angle)*10),color='orange',linetype=2)+
# geom_line(aes(time,verg.velocity-predV),color='red',linetype=2)
ylim(c(-50,150))+
geom_point(aes(time,saccadic*50))
manipulate({
d=filter(z,time>=window,time<window+window_size)
ggplot(d)+
geom_point(aes(time,showrasters+30),shape='|')+
# geom_point(aes(time,showenhance*verg.velocity),color='magenta')+
# geom_line(aes(time,sdf-100),color='hotpink')+
# geom_line(aes(time,slowpredict),color='orange')+
geom_line(aes(time,verg.angle*10+0),color='darkgreen')+
# geom_line(aes(time,predP/1000),color='darkgreen',linetype=2)+
geom_line(aes(time,predV),color='orange')+
# geom_line(aes(time,predV2),color='magenta')+
geom_line(aes(time,verg.velocity),color='darkblue')+
# geom_area(aes(time,conj.velocity),alpha=1/3)+
# geom_line(aes(time,sdf),alpha=1/3)+
# geom_line(aes(time,rep*10+200),color='red')+
# geom_line(aes(time,lep*10+200),color='blue')+
# geom_line(aes(time,repV*10+300),color='red')+
# geom_line(aes(time,lepV*10+300),color='blue')+
# geom_line(aes(time,cumsum(predV)/100+first(verg.angle)*10),color='orange',linetype=2)+
# geom_line(aes(time,verg.velocity-predV),color='red',linetype=2)
ylim(c(-50,150))+
geom_point(aes(time,saccadic*50))
# geom_line(aes(time,target.verg*10))
# geom_line(aes(time,(target.verg-verg.angle)*10),color='hotpink')
},
window_size=slider(1000,5000,step=100,initial = 4000),
window=slider(window_size,max(z$time-window_size),step=4000))
manipulate({
d=filter(z,time>=window,time<window+window_size)
ggplot(d)+
geom_point(aes(time,showrasters+30),shape='|')+
# geom_point(aes(time,showenhance*verg.velocity),color='magenta')+
# geom_line(aes(time,sdf-100),color='hotpink')+
# geom_line(aes(time,slowpredict),color='orange')+
geom_line(aes(time,verg.angle*10+0),color='darkgreen')+
# geom_line(aes(time,predP/1000),color='darkgreen',linetype=2)+
geom_line(aes(time,predV),color='orange')+
# geom_line(aes(time,predV2),color='magenta')+
geom_line(aes(time,verg.velocity),color='darkblue')+
# geom_area(aes(time,conj.velocity),alpha=1/3)+
# geom_line(aes(time,sdf),alpha=1/3)+
# geom_line(aes(time,rep*10+200),color='red')+
# geom_line(aes(time,lep*10+200),color='blue')+
# geom_line(aes(time,repV*10+300),color='red')+
# geom_line(aes(time,lepV*10+300),color='blue')+
# geom_line(aes(time,cumsum(predV)/100+first(verg.angle)*10),color='orange',linetype=2)+
# geom_line(aes(time,verg.velocity-predV),color='red',linetype=2)
ylim(c(-25,150))+
geom_point(aes(time,saccadic*50))
# geom_line(aes(time,target.verg*10))
# geom_line(aes(time,(target.verg-verg.angle)*10),color='hotpink')
},
window_size=slider(1000,5000,step=100,initial = 4000),
window=slider(window_size,max(z$time-window_size),step=4000))
manipulate({
d=filter(z,time>=window,time<window+window_size)
ggplot(d)+
geom_point(aes(time,showrasters+30),shape='|')+
# geom_point(aes(time,showenhance*verg.velocity),color='magenta')+
# geom_line(aes(time,sdf-100),color='hotpink')+
# geom_line(aes(time,slowpredict),color='orange')+
geom_line(aes(time,verg.angle*10+0),color='darkgreen')+
# geom_line(aes(time,predP/1000),color='darkgreen',linetype=2)+
geom_line(aes(time,predV),color='orange')+
# geom_line(aes(time,predV2),color='magenta')+
geom_line(aes(time,verg.velocity),color='darkblue')+
# geom_area(aes(time,conj.velocity),alpha=1/3)+
# geom_line(aes(time,sdf),alpha=1/3)+
geom_line(aes(time,rep*10+50),color='red')+
geom_line(aes(time,lep*10+50),color='blue')+
geom_line(aes(time,repV*10+300),color='red')+
# geom_line(aes(time,lepV*10+300),color='blue')+
# geom_line(aes(time,cumsum(predV)/100+first(verg.angle)*10),color='orange',linetype=2)+
# geom_line(aes(time,verg.velocity-predV),color='red',linetype=2)
ylim(c(-25,150))+
geom_point(aes(time,saccadic*50))
# geom_line(aes(time,target.verg*10))
# geom_line(aes(time,(target.verg-verg.angle)*10),color='hotpink')
},
window_size=slider(1000,5000,step=100,initial = 4000),
window=slider(window_size,max(z$time-window_size),step=4000))
manipulate({
d=filter(z,time>=window,time<window+window_size)
ggplot(d)+
geom_point(aes(time,showrasters+30),shape='|')+
# geom_point(aes(time,showenhance*verg.velocity),color='magenta')+
# geom_line(aes(time,sdf-100),color='hotpink')+
# geom_line(aes(time,slowpredict),color='orange')+
geom_line(aes(time,verg.angle*10+0),color='darkgreen')+
# geom_line(aes(time,predP/1000),color='darkgreen',linetype=2)+
geom_line(aes(time,predV),color='orange')+
# geom_line(aes(time,predV2),color='magenta')+
geom_line(aes(time,verg.velocity),color='darkblue')+
# geom_area(aes(time,conj.velocity),alpha=1/3)+
# geom_line(aes(time,sdf),alpha=1/3)+
geom_line(aes(time,rep+50),color='red')+
geom_line(aes(time,lep+50),color='blue')+
geom_line(aes(time,repV+300),color='purple')+
# geom_line(aes(time,lepV*10+300),color='blue')+
# geom_line(aes(time,cumsum(predV)/100+first(verg.angle)*10),color='orange',linetype=2)+
# geom_line(aes(time,verg.velocity-predV),color='red',linetype=2)
ylim(c(-25,150))+
geom_point(aes(time,saccadic*50))
# geom_line(aes(time,target.verg*10))
# geom_line(aes(time,(target.verg-verg.angle)*10),color='hotpink')
},
window_size=slider(1000,5000,step=100,initial = 4000),
window=slider(window_size,max(z$time-window_size),step=4000))
manipulate({
d=filter(z,time>=window,time<window+window_size)
ggplot(d)+
geom_point(aes(time,showrasters+30),shape='|')+
# geom_point(aes(time,showenhance*verg.velocity),color='magenta')+
# geom_line(aes(time,sdf-100),color='hotpink')+
# geom_line(aes(time,slowpredict),color='orange')+
geom_line(aes(time,verg.angle*10+0),color='darkgreen')+
# geom_line(aes(time,predP/1000),color='darkgreen',linetype=2)+
geom_line(aes(time,predV),color='orange')+
# geom_line(aes(time,predV2),color='magenta')+
geom_line(aes(time,verg.velocity),color='darkblue')+
# geom_area(aes(time,conj.velocity),alpha=1/3)+
# geom_line(aes(time,sdf),alpha=1/3)+
geom_line(aes(time,rep+50),color='red')+
geom_line(aes(time,lep+50),color='blue')+
geom_line(aes(time,repV+50),color='purple')+
# geom_line(aes(time,lepV*10+300),color='blue')+
# geom_line(aes(time,cumsum(predV)/100+first(verg.angle)*10),color='orange',linetype=2)+
# geom_line(aes(time,verg.velocity-predV),color='red',linetype=2)
ylim(c(-25,150))+
geom_point(aes(time,saccadic*50))
# geom_line(aes(time,target.verg*10))
# geom_line(aes(time,(target.verg-verg.angle)*10),color='hotpink')
},
window_size=slider(1000,5000,step=100,initial = 4000),
window=slider(window_size,max(z$time-window_size),step=4000))
manipulate({
d=filter(z,time>=window,time<window+window_size)
d<- mutate(saccadic=replace(saccadic,!saccadic,NA))
ggplot(d)+
geom_point(aes(time,showrasters+30),shape='|')+
# geom_point(aes(time,showenhance*verg.velocity),color='magenta')+
# geom_line(aes(time,sdf-100),color='hotpink')+
# geom_line(aes(time,slowpredict),color='orange')+
geom_line(aes(time,verg.angle*10+0),color='darkgreen')+
# geom_line(aes(time,predP/1000),color='darkgreen',linetype=2)+
geom_line(aes(time,predV),color='orange')+
# geom_line(aes(time,predV2),color='magenta')+
geom_line(aes(time,verg.velocity),color='darkblue')+
# geom_area(aes(time,conj.velocity),alpha=1/3)+
# geom_line(aes(time,sdf),alpha=1/3)+
geom_line(aes(time,rep+50),color='red')+
geom_line(aes(time,lep+50),color='blue')+
geom_line(aes(time,repV+50),color='purple')+
# geom_line(aes(time,lepV*10+300),color='blue')+
# geom_line(aes(time,cumsum(predV)/100+first(verg.angle)*10),color='orange',linetype=2)+
# geom_line(aes(time,verg.velocity-predV),color='red',linetype=2)
ylim(c(-25,150))+
geom_point(aes(time,saccadic*50))
# geom_line(aes(time,target.verg*10))
# geom_line(aes(time,(target.verg-verg.angle)*10),color='hotpink')
},
window_size=slider(1000,5000,step=100,initial = 4000),
window=slider(window_size,max(z$time-window_size),step=4000))
manipulate({
d=filter(z,time>=window,time<window+window_size)
d<- mutate(d,saccadic=replace(saccadic,!saccadic,NA))
ggplot(d)+
geom_point(aes(time,showrasters+30),shape='|')+
# geom_point(aes(time,showenhance*verg.velocity),color='magenta')+
# geom_line(aes(time,sdf-100),color='hotpink')+
# geom_line(aes(time,slowpredict),color='orange')+
geom_line(aes(time,verg.angle*10+0),color='darkgreen')+
# geom_line(aes(time,predP/1000),color='darkgreen',linetype=2)+
geom_line(aes(time,predV),color='orange')+
# geom_line(aes(time,predV2),color='magenta')+
geom_line(aes(time,verg.velocity),color='darkblue')+
# geom_area(aes(time,conj.velocity),alpha=1/3)+
# geom_line(aes(time,sdf),alpha=1/3)+
geom_line(aes(time,rep+50),color='red')+
geom_line(aes(time,lep+50),color='blue')+
geom_line(aes(time,repV+50),color='purple')+
# geom_line(aes(time,lepV*10+300),color='blue')+
# geom_line(aes(time,cumsum(predV)/100+first(verg.angle)*10),color='orange',linetype=2)+
# geom_line(aes(time,verg.velocity-predV),color='red',linetype=2)
ylim(c(-25,150))+
geom_point(aes(time,saccadic*50))
# geom_line(aes(time,target.verg*10))
# geom_line(aes(time,(target.verg-verg.angle)*10),color='hotpink')
},
window_size=slider(1000,5000,step=100,initial = 4000),
window=slider(window_size,max(z$time-window_size),step=4000))
manipulate({
d=filter(z,time>=window,time<window+window_size)
d<- mutate(d,saccadic=replace(saccadic,!saccadic,NA))
ggplot(d)+
geom_point(aes(time,showrasters+30),shape='|')+
# geom_point(aes(time,showenhance*verg.velocity),color='magenta')+
# geom_line(aes(time,sdf-100),color='hotpink')+
# geom_line(aes(time,slowpredict),color='orange')+
geom_line(aes(time,verg.angle*10+0),color='darkgreen')+
# geom_line(aes(time,predP/1000),color='darkgreen',linetype=2)+
geom_line(aes(time,predV),color='orange')+
# geom_line(aes(time,predV2),color='magenta')+
geom_line(aes(time,verg.velocity),color='darkblue')+
# geom_area(aes(time,conj.velocity),alpha=1/3)+
# geom_line(aes(time,sdf),alpha=1/3)+
geom_line(aes(time,rep+50),color='red')+
geom_line(aes(time,lep+50),color='blue')+
geom_line(aes(time,repV+50),color='purple')+
# geom_line(aes(time,lepV*10+300),color='blue')+
# geom_line(aes(time,cumsum(predV)/100+first(verg.angle)*10),color='orange',linetype=2)+
# geom_line(aes(time,verg.velocity-predV),color='red',linetype=2)
ylim(c(-25,100))+
geom_point(aes(time,saccadic*50))
# geom_line(aes(time,target.verg*10))
# geom_line(aes(time,(target.verg-verg.angle)*10),color='hotpink')
},
window_size=slider(1000,5000,step=100,initial = 4000),
window=slider(window_size,max(z$time-window_size),step=4000))
manipulate({
d=filter(z,time>=window,time<window+window_size)
d<- mutate(d,saccadic=replace(saccadic,!saccadic,NA))
ggplot(d)+
geom_point(aes(time,showrasters+30),shape='|')+
# geom_point(aes(time,showenhance*verg.velocity),color='magenta')+
# geom_line(aes(time,sdf-100),color='hotpink')+
# geom_line(aes(time,slowpredict),color='orange')+
geom_line(aes(time,verg.angle*10+0),color='darkgreen')+
# geom_line(aes(time,predP/1000),color='darkgreen',linetype=2)+
geom_line(aes(time,predV),color='orange')+
# geom_line(aes(time,predV2),color='magenta')+
geom_line(aes(time,verg.velocity),color='darkblue')+
# geom_area(aes(time,conj.velocity),alpha=1/3)+
# geom_line(aes(time,sdf),alpha=1/3)+
geom_line(aes(time,rep+50),color='red')+
geom_line(aes(time,lep+50),color='blue')+
geom_line(aes(time,repV+50),color='purple')+
# geom_line(aes(time,lepV*10+300),color='blue')+
# geom_line(aes(time,cumsum(predV)/100+first(verg.angle)*10),color='orange',linetype=2)+
# geom_line(aes(time,verg.velocity-predV),color='red',linetype=2)
ylim(c(-25,NA))+
geom_point(aes(time,saccadic*50))
# geom_line(aes(time,target.verg*10))
# geom_line(aes(time,(target.verg-verg.angle)*10),color='hotpink')
},
window_size=slider(1000,5000,step=100,initial = 4000),
window=slider(window_size,max(z$time-window_size),step=4000))
window_size=4000
manipulate({
d=filter(z,time>=window,time<window+window_size)
d<- mutate(d,saccadic=replace(saccadic,!saccadic,NA))
ggplot(d)+
geom_point(aes(time,showrasters+30),shape='|')+
# geom_point(aes(time,showenhance*verg.velocity),color='magenta')+
# geom_line(aes(time,sdf-100),color='hotpink')+
# geom_line(aes(time,slowpredict),color='orange')+
geom_line(aes(time,verg.angle*10+0),color='darkgreen')+
# geom_line(aes(time,predP/1000),color='darkgreen',linetype=2)+
geom_line(aes(time,predV),color='orange')+
# geom_line(aes(time,predV2),color='magenta')+
geom_line(aes(time,verg.velocity),color='darkblue')+
# geom_area(aes(time,conj.velocity),alpha=1/3)+
# geom_line(aes(time,sdf),alpha=1/3)+
geom_line(aes(time,rep+50),color='red')+
geom_line(aes(time,lep+50),color='blue')+
geom_line(aes(time,repV+50),color='purple')+
# geom_line(aes(time,lepV*10+300),color='blue')+
# geom_line(aes(time,cumsum(predV)/100+first(verg.angle)*10),color='orange',linetype=2)+
# geom_line(aes(time,verg.velocity-predV),color='red',linetype=2)
ylim(c(-25,NA))+
geom_point(aes(time,saccadic*50))
# geom_line(aes(time,target.verg*10))
# geom_line(aes(time,(target.verg-verg.angle)*10),color='hotpink')
},
window_size=slider(1000,5000,step=100,initial = 4000),
window=slider(window_size,max(z$time-window_size),step=4000))
t<- readRDS('SOA.RDS')
makefig1<- function(t,neuronChoice,starttime,stoptime,sd=10,maxplot=150){
gc<- filter(t,neuron==neuronChoice)
gc<-mutate(gc,time=row_number(), showrasters=replace(rasters,rasters<1,NA))
gc<- filter(gc, time>=starttime,time<stoptime)
gc<- mutate(gc,sdf=spikedensity(rasters,sd=sd))
gs<- ggplot(gc)+
geom_area(aes(time,sdf),alpha=1/10)+
geom_line(aes(time,lev-rev),color='darkblue',alpha=1)+
geom_line(aes(time,(lep-rep)*5+50),color='darkgreen')+
geom_point(aes(time,showrasters+50),shape='|')+
theme_bw()+
xlab('Time (ms)')+
ylab('Vergence Velocity (deg/s)')+
ylim(c(-100,maxplot))
}
fig1c <- makefig1(t,'Bee-215',90000,100000,sd=20,maxplot=250)
fig1c
fig1c+geom_line(aes(time,(lepV+repV)*5/2)+100,color='purple')
fig1c+geom_line(aes(time,(lepV+repV)*5/2+100),color='purple')
fig1c+geom_line(aes(time,(lepV+repV)*5/2+150),color='purple')
fig1c+
geom_line(aes(time,(lepV+repV)*5/2+150),color='purple')+
annotate('text',x=92500,y=200,label='Vertical Eye Position')
fig1c+
geom_line(aes(time,(lepV+repV)*5/2+150),color='purple')+
annotate('text',x=92500,y=200,label='Vertical Eye Position')+
annotate('text',x=92500,y=90,label='Vergence Position')
fig1c+
geom_line(aes(time,(lepV+repV)*5/2+150),color='purple')+
annotate('text',x=92500,y=200,label='Vertical Eye Position')+
annotate('text',x=92500,y=90,label='Vergence Position')+
geom_line(aes(time,(levV+revV)/2+200,color='purple',linetype=2))
fig1c+
geom_line(aes(time,(lepV+repV)*5/2+150),color='purple')+
annotate('text',x=92500,y=200,label='Vertical Eye Position')+
annotate('text',x=92500,y=90,label='Vergence Position')+
geom_line(aes(time,(levV+revV)/2+200,color='purple',linestyle=2))
fig1c+
geom_line(aes(time,(lepV+repV)*5/2+150),color='purple')+
annotate('text',x=92500,y=200,label='Vertical Eye Position')+
annotate('text',x=92500,y=90,label='Vergence Position')+
geom_line(aes(time,(levV+revV)/2+200),color='purple',linetype=2)
fig1c+
geom_line(aes(time,(lepV+repV)*5/2+150),color='purple')+
annotate('text',x=92500,y=150,label='Vertical Eye Position')+
anonotate('text',x=94900,y=210,label='Vertical Eye Velocity')+
annotate('text',x=92500,y=90,label='Vergence Position')+
geom_line(aes(time,(levV+revV)/2+200),color='purple',linetype=2)
fig1c+
geom_line(aes(time,(lepV+repV)*5/2+150),color='purple')+
annotate('text',x=92500,y=150,label='Vertical Eye Position')+
annotate('text',x=94900,y=210,label='Vertical Eye Velocity')+
annotate('text',x=92500,y=90,label='Vergence Position')+
geom_line(aes(time,(levV+revV)/2+200),color='purple',linetype=2)
fig1c+
geom_line(aes(time,(lepV+repV)*5/2+150),color='purple')+
annotate('text',x=92500,y=190,label='Vertical Eye Position')+
# annotate('text',x=94900,y=210,label='Vertical Eye Velocity')+
annotate('text',x=92500,y=90,label='Vergence Position')
fig1c+
geom_line(aes(time,(lepV+repV)*5/2+150),color='purple')+
annotate('text',x=92500,y=210,label='Vertical Eye Position')+
# annotate('text',x=94900,y=210,label='Vertical Eye Velocity')+
annotate('text',x=92500,y=90,label='Vergence Position')
fig1c+
geom_line(aes(time,(lepV+repV)*5/2+150),color='purple')+
annotate('text',x=92500,y=210,label='Vertical Eye Position')+
annotate('text',x=92500,y=-50,label='Vergence Velocity')+
annotate('text',x=92500,y=90,label='Vergence Position')
fig1c+
geom_line(aes(time,(lepV+repV)*5/2+150),color='purple')+
annotate('text',x=92500,y=210,label='Vertical Eye Position')+
annotate('text',x=92500,y=-30,label='Vergence Velocity')+
annotate('text',x=92500,y=90,label='Vergence Position')
